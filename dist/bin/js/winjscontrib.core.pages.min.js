/* 
 * WinJS Contrib v2.1.0.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var profiler=window.msWriteProfilerMark||function(){},WinJSContrib;!function(e){var t;!function(t){var n;!function(t){function n(e,t,n,r,i,o){var s=[];i&&s.push(WinJS.Promise.as(i.apply(e,r)));var a=t.querySelectorAll(".mcn-layout-ctrl");if(a&&a.length){for(var u=0,l=a.length;l>u;){var c=a[u];if(c){var p=c.winControl[n];p&&s.push(WinJS.Promise.as(p.apply(c.winControl,r)))}u+=1}return o&&s.push(WinJS.Promise.as(o.apply(e,r))),WinJS.Promise.join(s)}return WinJS.Promise.wrap()}function r(t,n,r,i){function o(t){r&&r.injectToPage&&e.Utils.inject(t,r.injectToPage),t.navigationState={location:n,state:r},i.oncreate&&i.oncreate(t.element,r),i.oninit&&t.elementReady.then(function(){i.oninit(t.element,r)}),(t.enterPageAnimation||i.enterPage)&&(t._enterAnimation=t.enterPageAnimation?t.enterPageAnimation:i.enterPage,t.enterPageAnimation=function(){var e=this,t=null;return u.style.opacity="",t=e&&e.getAnimationElements?e.getAnimationElements(!1):e.element,t?e._enterAnimation(t):void 0}),i.closeOldPagePromise&&t.pageLifeCycle.steps.layout.attach(function(){return i.closeOldPagePromise}),t.contentReadyComplete=t.renderComplete.then(function(){return i.onrender&&i.onrender(t.element,r),e.UI.disableAutoResources?void 0:WinJS.Resources.processAll(u)}),t.readyComplete.then(function(){return i.onready&&i.onready(t.element,r),t.enterPageAnimation?WinJS.Promise.as(t.enterPageAnimation(u,i)):void(t.element.style.opacity="")}).then(s,a)}var s,a;i=i||{};var u=document.createElement("div");u.setAttribute("dir",window.getComputedStyle(u,null).direction),u.style.opacity="0",t.appendChild(u);{var l=new WinJS.Promise(function(e,t){s=e,a=t}),c=i.parented?WinJS.Promise.as(i.parented):null,p=WinJS.UI.Pages.get(n);new p(u,r,o,c)}return l}t.defaultFragmentMixins=[{$:function(e){return $(e,this.element||this._element)},q:function(e){return this.element?this.element.querySelector(e):void 0},qAll:function(e){if(this.element){var t=this.element.querySelectorAll(e);return t&&!t.forEach&&(t=[].slice.call(t)),t}}},{dispose:function(){this._promises&&(this.cancelPromises(),this._promises=null)},promises:{configurable:!0,get:function(){return this._promises||(this._promises=[]),this._promises}},addPromise:function(e){return this.promises.push(e),e},cancelPromises:function(){var e=this;if(e.promises)for(var t=0;t<e.promises.length;t++)e.promises[t]&&e.promises[t].cancel()}},{dispose:function(){this._eventTracker&&(this._eventTracker.dispose(),this._eventTracker=null)},eventTracker:{configurable:!0,get:function(){return this._eventTracker||(this._eventTracker=new e.UI.EventTracker),this._eventTracker}}}],t.renderFragment=r;var i=function(){function e(e,t,n){var r=this;this.queue=[],this.isDone=!1,this.stepName=t,this.promise=new WinJS.Promise(function(e,t){r._resolvePromise=e,r._rejectPromise=t}),n&&n.pageLifeCycle.steps[t].attach(function(){return r.promise})}return e.prototype.attach=function(e){return this.isDone?WinJS.Promise.as(e):(this.queue.push(e),this.promise)},e.prototype.resolve=function(e){var t=this;this.isDone=!0;var n=[];return this.queue.length&&this.queue.forEach(function(e){n.push(WinJS.Promise.as(e()))}),WinJS.Promise.join(n).then(function(){return t._resolvePromise(e),t.promise},this.reject)},e.prototype.reject=function(e){return this.isDone=!0,this._rejectPromise(e),this.promise},e}();t.PageLifeCycleStep=i,function(t,r,o,s,a,u,l,c,p,d){"use strict";function f(e){var t=r.document.createElement("a");return t.href=e,t.href}function m(e){return r.document.location.href.toLowerCase()===e.toLowerCase()}function h(e,t){var n=e.prototype.dispose;return e=o.Class.mix(e,t),n&&t.hasOwnProperty("dispose")&&(e.prototype.dispose=function(){n.apply(this),t.dispose.apply(this)}),e}function y(e,t){return t?(t.__proto__.hasOwnProperty("hasOwnProperty")||y(e,t.__proto__),h(e,t)):e}function g(e,t){return t?"function"==typeof t?(e.prototype._attachedConstructors||(e.prototype._attachedConstructors=[]),e.prototype._attachedConstructors.push(t),y(e,t.prototype)):"object"==typeof t?h(e,t):e:e}function v(t,r,i,o,s,u){i.style.display&&(t.pageLifeCycle.initialDisplay=i.style.display),i.style.display="none";var p=" uri='"+r+"'"+a._getProfilerMarkIdentifier(t.element);l("WinJS.UI.Pages:createPage"+p+",StartTM"),e.UI.WebComponents&&(t.observer=e.UI.WebComponents.watch(t.element));var d=c.timeout().then(function(){return t.load(r)}),f=d.then(function(e){return t._attachedConstructors&&t._attachedConstructors.forEach(function(e){e.apply(t,[i,o])}),c.join({loadResult:e,initResult:t.init(i,o)})}).then(function(e){return t.pageLifeCycle.steps.init.resolve().then(function(){return e})}).then(function(e){return t.render(i,o,e.loadResult)}).then(function(){return t.pageLifeCycle.steps.render.resolve()});t.elementReady=f.then(function(){return i}),t.renderComplete=f.then(function(){return t.process(i,o)}).then(function(){return e.UI.WebComponents?WinJS.Promise.timeout():void 0}).then(function(){return t.pageLifeCycle.steps.process.resolve()}).then(function(){return e.UI.bindMembers(i,t),t.processed(i,o)});var m=function(){s&&s(t),l("WinJS.UI.Pages:createPage"+p+",StopTM")};t.renderComplete.then(m,m),t.layoutComplete=t.renderComplete.then(function(){return u}).then(function(){i.style.display=t.pageLifeCycle.initialDisplay||"";i.getBoundingClientRect();return n(t,i,"pageLayout",[i,o],null,t.pageLayout)}).then(function(){return e.UI.bindActions(i,t),t.pageLifeCycle.steps.layout.resolve()}),t.readyComplete=t.layoutComplete.then(function(){t.ready(i,o),t.pageLifeCycle.ended=new Date,t.pageLifeCycle.delta=t.pageLifeCycle.ended-t.pageLifeCycle.created,console.log("navigation to "+r+" took "+t.pageLifeCycle.delta+"ms"),n(t,i,"pageReady",[i,o])}).then(function(){return t.pageLifeCycle.steps.ready.resolve()}).then(null,function(e){return t.error?t.error(e):void 0}),t.__checkLayout=function(){var e=this,t=arguments,r=null;return r=e.updateLayout?WinJS.Promise.as(e.updateLayout.apply(e,t)):WinJS.Promise.wrap(),r.then(function(){return n(e,e.element,"updateLayout",t)})}}function C(t,n){var s=f(t).toLowerCase(),a=W[s];return t=f(t),a||(a=o.Class.define(function(n,o,s,a){var l=this,c=e.Utils.getScopeControl(n);l.pageLifeCycle={created:new Date,location:t,steps:{init:new i(l,"init",null),render:new i(l,"render",null),process:new i(l,"process",c),layout:new i(l,"layout",c),ready:new i(l,"ready",c)},initialDisplay:null},this._disposed=!1,this.element=n=n||r.document.createElement("div"),n.msSourceLocation=t,this.uri=t,this.selfhost=m(t),n.winControl=this,l.parentedComplete=a,u.addClass(n,"win-disposable"),u.addClass(n,"pagecontrol"),u.addClass(n,"mcn-layout-ctrl"),v(this,t,n,o,s,a)},J),a=o.Class.mix(a,WinJS.UI.DOMEventMixin),a.winJSContrib=!0,e.UI.Pages.defaultFragmentMixins.forEach(function(e){h(a,e)}),W[s]=a),a=g(a,n),a.selfhost=m(t),a}function P(e,t){var n=W[e];return n||(n=C(e)),t&&(n=g(n,t)),n.selfhost&&WinJS.Utilities.ready(function(){_(f(e),r.document.body)},!0),n}function _(e,t,n,r){var i=s.get(e),o=new i(t,n,null,r);return o.renderComplete.then(null,function(e){return c.wrapError({error:e,page:o})})}function S(e){var t=W[e];return t||(t=P(e)),t}function w(e){p.clearCache(f(e)),delete W[e.toLowerCase()]}var W=s._viewMap||{},J={dispose:function(){this._disposed||(this._disposed=!0,this.readyComplete.cancel(),u.disposeSubTree(this.element),this.element=null)},init:function(){},load:function(e){return this.selfhost?void 0:p.renderCopy(f(e))},process:function(e){return d.processAll(e)},processed:function(){},render:function(e,t,n){return this.selfhost||e.appendChild(n),e},ready:function(){}};t._corePages={get:s.get,render:s.render,define:s.define,_remove:s._remove,_viewMap:s._viewMap};var L={define:P,get:S,render:_,_remove:w,_viewMap:W},U=WinJS.UI.Pages;WinJS.Namespace._moduleDefine(t,null,L),U.get=L.get,U.define=L.define,U.render=L.render,U._remove=L._remove}(e.UI.Pages,window,WinJS,WinJS.UI.Pages,WinJS.Utilities,WinJS.Utilities,profiler,WinJS.Promise,WinJS.UI.Fragments,WinJS.UI)}(n=t.Pages||(t.Pages={}))}(t=e.UI||(e.UI={}))}(WinJSContrib||(WinJSContrib={}));