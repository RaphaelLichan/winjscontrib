/* 
 * WinJS Contrib v2.1.0.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var __global=this,profiler=__global.msWriteProfilerMark||function(){},WinJSContrib;!function(e){var t;!function(t){var n;!function(t){function n(e,t,n,i,r,o){var s=[];r&&s.push(WinJS.Promise.as(r.apply(e,i)));var a=t.querySelectorAll(".mcn-layout-ctrl");if(a&&a.length){for(var u=0,l=a.length;l>u;){var c=a[u];if(c){var p=c.winControl[n];p&&s.push(WinJS.Promise.as(p.apply(c.winControl,i)))}u+=1}return o&&s.push(WinJS.Promise.as(o.apply(e,i))),WinJS.Promise.join(s)}return WinJS.Promise.wrap()}function i(t,n,i,r){function o(t){i&&i.injectToPage&&e.Utils.inject(t,i.injectToPage),t.navigationState={location:n,state:i},r.oncreate&&r.oncreate(t.element,i),r.oninit&&t.elementReady.then(function(){r.oninit(t.element,i)}),(t.enterPageAnimation||r.enterPage)&&(t._enterAnimation=t.enterPageAnimation?t.enterPageAnimation:r.enterPage,t.enterPageAnimation=function(){var e=this,t=null;return u.style.opacity="",t=e&&e.getAnimationElements?e.getAnimationElements(!1):e.element,t?e._enterAnimation(t):void 0}),t.contentReadyComplete=t.renderComplete.then(function(){return r.onrender&&r.onrender(t.element,i),e.UI.disableAutoResources?void 0:WinJS.Resources.processAll(u)}),t.readyComplete.then(function(){return r.closeOldPagePromise?r.closeOldPagePromise:void 0}).then(function(){return r.onready&&r.onready(t.element,i),t.enterPageAnimation?WinJS.Promise.as(t.enterPageAnimation(u,r)):void(t.element.style.opacity="")}).then(s,a)}var s,a;r=r||{};var u=document.createElement("div");u.setAttribute("dir",__global.getComputedStyle(u,null).direction),u.style.opacity="0",t.appendChild(u);{var l=new WinJS.Promise(function(e,t){s=e,a=t}),c=r.parented?WinJS.Promise.as(r.parented):null,p=WinJS.UI.Pages.get(n);new p(u,i,o,c)}return l}t.defaultFragmentMixins=[{$:function(e){return $(e,this.element||this._element)},q:function(e){return this.element?this.element.querySelector(e):void 0},qAll:function(e){if(this.element){var t=this.element.querySelectorAll(e);return t&&!t.forEach&&(t=[].slice.call(t)),t}}},{dispose:function(){this._promises&&(this.cancelPromises(),this._promises=null)},promises:{configurable:!0,get:function(){return this._promises||(this._promises=[]),this._promises}},addPromise:function(e){return this.promises.push(e),e},cancelPromises:function(){var e=this;if(e.promises)for(var t=0;t<e.promises.length;t++)e.promises[t]&&e.promises[t].cancel()}},{dispose:function(){this._eventTracker&&(this._eventTracker.dispose(),this._eventTracker=null)},eventTracker:{configurable:!0,get:function(){return this._eventTracker||(this._eventTracker=new e.UI.EventTracker),this._eventTracker}}}],t.renderFragment=i;var r=function(){function e(e,t,n){var i=this;this.queue=[],this.isDone=!1,this.stepName=t,this.promise=new WinJS.Promise(function(e,t){i._resolvePromise=e,i._rejectPromise=t}),e.promises.push(this.promise),n&&n.pageLifeCycle.steps[t].attach(function(){return i.promise})}return e.prototype.attach=function(e){return this.queue&&!this.isDone?(this.queue.push(e),this.promise):WinJS.Promise.as(e())},e.prototype.resolve=function(e){var t=this;this.isDone=!0;var n=[];return this.queue&&this.queue.length&&(this.queue.forEach(function(e){n.push(new WinJS.Promise(function(t,n){try{WinJS.Promise.as(e()).then(function(e){t(e)},n)}catch(i){n(i)}}))}),this.queue=null),WinJS.Promise.join(n).then(function(){return t._resolvePromise(e),t.promise},this.reject.bind(this))},e.prototype.reject=function(e){return this.isDone=!0,this.queue=null,this._rejectPromise(e),this.promise},e}();t.PageLifeCycleStep=r,function(t,i,o,s,a,u,l,c,p,f){"use strict";function d(e){var t=i.document.createElement("a");return t.href=e,t.href}function h(e){return i.document.location.href.toLowerCase()===e.toLowerCase()}function m(e,t){var n=e.prototype.dispose;return e=o.Class.mix(e,t),n&&t.hasOwnProperty("dispose")&&(e.prototype.dispose=function(){n.apply(this),t.dispose.apply(this)}),e}function y(e,t){return t?(t.__proto__.hasOwnProperty("hasOwnProperty")||y(e,t.__proto__),m(e,t)):e}function g(e,t){return t?"function"==typeof t?(e.prototype._attachedConstructors||(e.prototype._attachedConstructors=[]),e.prototype._attachedConstructors.push(t),y(e,t.prototype)):"object"==typeof t?m(e,t):e:e}function v(t,i,r,o,s,u){r.style.display&&(t.pageLifeCycle.initialDisplay=r.style.display),r.style.display="none";var p=" uri='"+i+"'"+a._getProfilerMarkIdentifier(t.element);l("WinJS.UI.Pages:createPage"+p+",StartTM"),e.UI.WebComponents&&(t.observer=e.UI.WebComponents.watch(t.element));var f=c.timeout().then(function(){return t.load(i)}),d=f.then(function(e){return t._attachedConstructors&&t._attachedConstructors.forEach(function(e){e.apply(t,[r,o])}),c.join({loadResult:e,initResult:t.init(r,o)})}).then(function(e){return t.pageLifeCycle.steps.init.resolve().then(function(){return e})}).then(function(e){return t.render(r,o,e.loadResult)}).then(function(){return t.pageLifeCycle.steps.render.resolve()});t.elementReady=d.then(function(){return r}),t.renderComplete=d.then(function(){return t.process(r,o)}).then(function(){return e.UI.WebComponents?WinJS.Promise.timeout():void 0}).then(function(){return t.pageLifeCycle.steps.process.resolve()}).then(function(){return e.UI.bindMembers(r,t),t.processed(r,o)});var h=function(){s&&s(t),l("WinJS.UI.Pages:createPage"+p+",StopTM")};t.renderComplete.then(h,h),t.layoutComplete=t.renderComplete.then(function(){return u}).then(function(){r.style.display=t.pageLifeCycle.initialDisplay||"";r.getBoundingClientRect();return n(t,r,"pageLayout",[r,o],null,t.pageLayout)}).then(function(){e.UI.bindActions(r,t)}).then(function(){return t.pageLifeCycle.steps.layout.resolve()}),t.readyComplete=t.layoutComplete.then(function(){t.ready(r,o),t.pageLifeCycle.ended=new Date,t.pageLifeCycle.delta=t.pageLifeCycle.ended-t.pageLifeCycle.created,console.log("navigation to "+i+" took "+t.pageLifeCycle.delta+"ms"),n(t,r,"pageReady",[r,o])}).then(function(){return t.pageLifeCycle.steps.ready.resolve()}).then(null,function(e){return t.error?t.error(e):void 0}),t.__checkLayout=function(){var e=this,t=arguments,i=null;return i=e.updateLayout?WinJS.Promise.as(e.updateLayout.apply(e,t)):WinJS.Promise.wrap(),i.then(function(){return n(e,e.element,"updateLayout",t)})}}function C(t,n){var s=d(t).toLowerCase(),a=J[s];return t=d(t),a||(a=o.Class.define(function(n,o,s,a){var l=this,c=e.Utils.getScopeControl(n);u.addClass(n,"win-disposable"),u.addClass(n,"pagecontrol"),u.addClass(n,"mcn-layout-ctrl"),l.pageLifeCycle={created:new Date,location:t,stop:function(){l.readyComplete.cancel(),l.cancelPromises()},steps:{init:new r(l,"init",null),render:new r(l,"render",null),process:new r(l,"process",c),layout:new r(l,"layout",c),ready:new r(l,"ready",c)},initialDisplay:null},this._disposed=!1,this.element=n=n||i.document.createElement("div"),n.msSourceLocation=t,this.uri=t,this.selfhost=h(t),n.winControl=this,l.parentedComplete=a,v(this,t,n,o,s,a)},w),a=o.Class.mix(a,WinJS.UI.DOMEventMixin),e.UI.Pages.defaultFragmentMixins.forEach(function(e){m(a,e)}),J[s]=a),a=g(a,n),a.selfhost=h(t),a}function P(e,t){var n=J[e];return n||(n=C(e)),t&&(n=g(n,t)),n.selfhost&&WinJS.Utilities.ready(function(){_(d(e),i.document.body)},!0),n}function _(e,t,n,i){var r=s.get(e),o=new r(t,n,null,i);return o.renderComplete.then(null,function(e){return c.wrapError({error:e,page:o})})}function S(e){var t=J[e];return t||(t=P(e)),t}function W(e){p.clearCache(d(e)),delete J[e.toLowerCase()]}if(i.document&&s){var J=s._viewMap||{},w={dispose:function(){this._disposed||(this._disposed=!0,this.readyComplete.cancel(),u.disposeSubTree(this.element),this.element=null)},init:function(){},load:function(e){return this.selfhost?void 0:p.renderCopy(d(e))},process:function(e){return f.processAll(e)},processed:function(){},render:function(e,t,n){return this.selfhost||e.appendChild(n),e},ready:function(){}};t._corePages={get:s.get,render:s.render,define:s.define,_remove:s._remove,_viewMap:s._viewMap};var L={define:P,get:S,render:_,_remove:W,_viewMap:J},U=WinJS.UI.Pages;WinJS.Namespace._moduleDefine(t,null,L),U.get=L.get,U.define=L.define,U.render=L.render,U._remove=L._remove,WinJS.UI.HtmlControl=WinJS.Class.define(function(e,t,n){WinJS.UI.Pages.render(t.uri,e,t).then(n,function(){n()})})}}(e.UI.Pages,__global,WinJS,WinJS.UI.Pages,WinJS.Utilities,WinJS.Utilities,profiler,WinJS.Promise,WinJS.UI.Fragments,WinJS.UI)}(n=t.Pages||(t.Pages={}))}(t=e.UI||(e.UI={}))}(WinJSContrib||(WinJSContrib={}));