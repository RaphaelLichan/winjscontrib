/* 
 * WinJS Contrib v2.1.0.6
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";var i=null;window.Windows&&window.Windows.UI&&window.Windows.UI.ViewManagement&&window.Windows.UI.ViewManagement.ApplicationView&&(i=window.Windows.UI.ViewManagement.ApplicationView);var t=WinJS.Navigation,n=function(i){return WinJS.UI.Animation.exitPage(i)},e=function(i){return WinJS.UI.Animation.enterPage(i)};WinJS.Namespace.define("WinJSContrib.UI",{parentNavigator:function(i){for(var t=i.parentNode;t;){if(t.mcnNavigator)return t.winControl;t=t.parentNode}},PageControlNavigator:WinJS.Class.mix(WinJS.Class.define(function(a,o){var o=o||{},r=this;if(this.element=a||document.createElement("div"),this.element.winControl=this,this.element.mcnNavigator=!0,this.element.classList.add("mcn-navigator"),this.element.classList.add("mcn-navigation-ctrl"),this.eventTracker=new WinJSContrib.UI.EventTracker,this.delay=o.delay||0,this.disableHistory=o.disableHistory||!1,this.animationWaitForPreviousPageClose=o.animationWaitForPreviousPageClose||!0,this.animations={},this.locks=0,o.enterPageAnimation&&(this.animations.enterPage=WinJSContrib.Utils.resolveMethod(a,o.enterPageAnimation)),this.animations.enterPage||(this.animations.enterPage=e),o.exitPageAnimation&&(this.animations.exitPage=WinJSContrib.Utils.resolveMethod(a,o.exitPageAnimation)),this.animations.exitPage||(this.animations.exitPage=n),this.home=o.home,i&&(this._lastViewstate=i.value),this.global=void 0!==o.global?o.global:!0,this.global){document.body.onkeyup=this._keyupHandler.bind(this),document.body.onkeypress=this._keypressHandler.bind(this),document.body.onmspointerup=this._mspointerupHandler.bind(this),WinJSContrib.UI.Application=WinJSContrib.UI.Application||{},WinJSContrib.UI.Application.navigator=this,this.eventTracker.addEvent(t,"beforenavigate",this._beforeNavigate.bind(this)),this.eventTracker.addEvent(t,"navigated",this._navigated.bind(this));var s=null;WinJSContrib.UI.enableSystemBackButton&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(s=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView()),s&&WinJSContrib.UI.enableSystemBackButton&&this.eventTracker.addEvent(s,"backrequested",function(i){WinJS.Navigation.canGoBack&&(r.back(),i.handled=!0)})}else o.navigationEvents&&this.addNavigationEvents(),this._history={backstack:[]};this.eventTracker.addEvent(window,"resize",function(i){r.resizeHandler&&cancelAnimationFrame(r.resizeHandler),r.resizeHandler=requestAnimationFrame(function(){r.resizeHandler=null,r._resized(i)})})},{home:"",element:null,_lastNavigationPromise:WinJS.Promise.as(),_lastViewstate:0,pageControl:{get:function(){return this.pageElement?this.pageElement.winControl:null}},pageElement:{get:function(){for(var i=this.element.lastElementChild;i&&i.winControl&&i.winControl.mcnPageClosing;)i=i.previousSibling;return i}},history:{get:function(){return this.global?WinJS.Navigation.history:this._history}},addLock:function(){this.locks++},removeLock:function(){this.locks--},_createPageElement:function(){var i=document.createElement("div");return i.setAttribute("dir",window.getComputedStyle(this.element,null).direction),i},dispose:function(){this._disposed||(this._disposed=!0,this.removeNavigationEvents(),WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element),this.eventTracker.dispose())},_checkBackNavigation:function(i){var t=this,n=t.pageControl,e=function(){i.handled=!0,i.preventDefault&&i.preventDefault()},a=function(){return t.canGoBack?(t.back(),e(),!0):void 0};if(!n.canClose)return a();var o=n.canClose();return WinJS.Promise.is(o)?void o.then(function(i){return i?a():(e(),!0)}):o?a():(e(),!0)},addNavigationEvents:function(){var i=this;this.navigationEvents=WinJSContrib.UI.registerNavigationEvents(this,function(t){i._checkBackNavigation(t)})},removeNavigationEvents:function(){this.navigationEvents&&(this.navigationEvents(),this.navigationEvents=null)},_getAnimationElements:function(i){return this.pageControl&&this.pageControl.getAnimationElements?this.pageControl.getAnimationElements(i):this.pageElement},_keypressHandler:function(i){this.locks>0||"Backspace"===i.key&&this.back()},_keyupHandler:function(i){this.locks>0||("Left"===i.key&&i.altKey||"BrowserBack"===i.key)&&this.back()},_mspointerupHandler:function(i){3===i.button?t.back():4===i.button&&t.forward()},navigate:function(i,t,n,e,a){var o=this;if(this.global)return WinJS.Navigation.navigate(i,t);var r={skipHistory:n,detail:{location:i,state:t,navigateStacked:a,setPromise:function(i){this.pagePromise=i}}};return o._beforeNavigate(r),r.detail.pagePromise=r.detail.pagePromise||WinJS.Promise.wrap(),o._history.current={state:t,location:i},r.detail.pagePromise.then(function(){return e&&o._history.backstack.splice(o._history.backstack.length-1,1),o._navigated(r),r.detail.pagePromise})},clearHistory:function(){this.global?WinJS.Navigation.history.backStack=[]:(this._history.backstack=[],this._history.current=null)},closeAllPages:function(){for(var i=this,t=i.element.children,n=t.length-1;n>=0;n--){var e=t[n];e&&e.classList.contains("pagecontrol")&&(i.element.removeChild(e),e.winControl.dispose())}},clear:function(){this.clearHistory(),this.closeAllPages(),this.element.innerHTML=""},open:function(i,t){return this.navigate(i,t)},pick:function(i,t){return t=t||{},t.navigateStacked=!0,this.navigate(i,t)},canGoBack:{get:function(){return this.global?t.canGoBack:this._history.backstack.length>0}},_handleStackedBack:function(){var i=this;if(i.global){var t=1==i.stackNavigation||WinJS.Navigation.history.current.state&&WinJS.Navigation.history.current.state.navigateStacked;if(t){var n=i.element.children[i.element.children.length-2];if(n)return WinJS.Navigation.history.backStack.splice(WinJS.Navigation.history.backStack.length-1,1),i.triggerPageExit(),i.closePage(i.pageControl.element).then(function(){i._updateBackButton(n.winControl.element),n.winControl&&n.winControl.navactivate&&n.winControl.navactivate(),WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()})}}},back:function(i){var t=this;if(t.global)return WinJS.Navigation.back(i);if(t._history.backstack.length){var n=t._history.backstack.length-1,e=t._history.backstack[n];return t.navigate(e.location,e.state,!0,!0)}},_beforeNavigate:function(i){var t=this,n=this.pageElement,e=i.detail.location,a=i.detail.state;i.detail.state=i.detail.state||{};var o=1==t.stackNavigation||i.detail.navigateStacked||i.detail.state.navigateStacked;if(t.global&&n&&n.winControl&&n.winControl.navigationState&&n.winControl.navigationState.state&&n.winControl.navigationState.state.navigateStacked){var r=WinJS.Navigation.history.backStack[WinJS.Navigation.history.backStack.length-1];if(e==r.location&&a==r.state){var s=t._handleStackedBack();if(WinJS.Promise.is(s))return WinJS.Navigation.history.current=r,void i.detail.setPromise(s.then(function(){var t=new WinJS.Promise(function(i){});return i.detail.setPromise(t),t.cancel(),t}))}}if(this.locks>0){var l=new WinJS.Promise(function(i){});return i.detail.setPromise(l),void l.cancel()}if(n&&n.winControl&&!o&&n.winControl.canClose){var c=null,l=new WinJS.Promise(function(i){c=i});return setImmediate(function(){WinJS.Promise.wrap(n.winControl.canClose()).then(function(i){i?(t.triggerPageExit(o),c()):l.cancel()})}),void i.detail.setPromise(l)}if(o&&!i.detail.state.mcnNavigationDetails&&n&&n.winControl){if(n.winControl.navdeactivate)return void i.detail.setPromise(WinJS.Promise.as(n.winControl.navdeactivate.apply(n.winControl)))}else{if(t.global&&!o&&WinJS.Navigation.history.current.state&&WinJS.Navigation.history.current.state.navigateStacked){t.closeAllPages();for(var g=WinJS.Navigation.history.backStack,d=g.length-1;d>=0;d--)g[d].state&&g[d].state.navigateStacked&&g.splice(d,1)}t.triggerPageExit()}},triggerPageExit:function(i){var t=this,n=this.pageElement;if(i)return void(n.winControl.exitPagePromise=n.winControl.navdeactivate?WinJS.Promise.as(n.winControl.navdeactivate()):WinJS.Promise.wrap());var e=function(){};if(n&&n.winControl&&!n.winControl.exitPagePromise){if(n.winControl.exitPage){var a=n.winControl.exitPage();if(a){var o=WinJS.Promise.as(a);n.winControl.exitPagePromise=o.then(function(){return n.winControl.exitPageAnimation?WinJS.Promise.as(n.winControl.exitPageAnimation()):void 0}).then(e)}else n.winControl.exitPagePromise=n.winControl.exitPageAnimation?WinJS.Promise.as(n.winControl.exitPageAnimation()).then(e):WinJS.Promise.as(t.animations.exitPage(t._getAnimationElements(!0))).then(e)}else n.winControl.exitPagePromise=n.winControl.exitPageAnimation?WinJS.Promise.as(n.winControl.exitPageAnimation()).then(e):WinJS.Promise.as(t.animations.exitPage(t._getAnimationElements(!0))).then(e);var r=n.querySelectorAll(".mcn-layout-ctrl");if(r&&r.length)for(var s=0;s<r.length;s++){var l=r[s].winControl;l.exitPage&&l.exitPage()}WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.show()}},closePage:function(i,t){var n=this;t=t||{};var e=(n.element,i||this.pageElement);e&&WinJSContrib.UI.untapAll(e);var a=e&&e.winControl&&e.winControl.exitPagePromise?e.winControl.exitPagePromise:WinJS.Promise.wrap();return n.dispatchEvent("closingPage",{page:e}),e&&e.winControl&&(e.winControl.mcnPageClosing=!0,e.winControl.pageLifeCycle.stop(),e.winControl.dispatchEvent("closing",{youpla:"boom"}),e.winControl.cancelPromises&&e.winControl.cancelPromises()),!n.global&&!n.disableHistory&&e&&e.winControl&&e.winControl.navigationState&&!t.skipHistory&&n._history.backstack.push(e.winControl.navigationState),setImmediate(function(){var i=n._lastNavigationPromise?n._lastNavigationPromise.then(function(){},function(){}):WinJS.Promise.wrap();i.then(function(){return a}).then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){n.destroyOldPage(e)})})},1e3),WinJS.Promise.wrap()},destroyOldPage:function(i){if(i){i.style.opacity="0",i.style.display="none",i.winControl&&(i.winControl.stackedOn=null,i.winControl.stackedBy=null,i.winControl.eventTracker&&i.winControl.eventTracker.dispose(),i.winControl.unload&&i.winControl.unload()),WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(i);try{i.parentElement&&i.parentElement.removeChild(i)}catch(t){console.log("cannot remove page, WTF ????????")}}},_navigated:function(i){var t=this;i.detail.state=i.detail.state||{};var n=t.element,e=this.pageControl,a=this.pageElement,o=1==t.stackNavigation||i.detail.navigateStacked||i.detail.state&&i.detail.state.navigateStacked;if(this._lastNavigationPromise&&(this._lastNavigationPromise.cancel(),WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()),e&&e.stackedOn&&i.detail.state.mcnNavigationDetails){var r=t.closePage(a,i);return this._lastNavigationPromise=r,i.detail.setPromise(r),void(WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide())}if(o){!t.global&&!t.disableHistory&&a&&a.winControl&&a.winControl.navigationState&&!i.skipHistory&&t._history.backstack.push(a.winControl.navigationState);var r=WinJS.Promise.wrap()}else var r=t.closePage(a,i);if(t.global&&!o)for(var s=WinJS.Navigation.history.backStack,l=s.length-1;l>=0;l--)s[l].state&&s[l].state.navigateStacked&&s.splice(l,1);i.detail.state.mcnNavigationDetails={id:WinJSContrib.Utils.guid(),date:new Date};{var c;new WinJS.Promise(function(i){c=i})}t.currentPageDetails=i.detail;var g=WinJSContrib.UI.Pages.renderFragment(n,i.detail.location,i.detail.state,{enterPage:t.animations.enterPage,getFragmentElement:t.fragmentInjector,closeOldPagePromise:r.then(function(){},function(){}),oninit:function(i,n){if(i){var a=i.winControl;a.navigator=t,a.element.mcnPage=!0,o&&(a.stackedOn=e,e&&(e.stackedBy=a)),a.renderComplete=a.renderComplete.then(function(){c()})}},onrender:function(n,e){if(i.detail.state&&i.detail.state.clearNavigationHistory)if(t.global){WinJS.Navigation.history.backStack=[];var a=null;WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(a=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),a&&(a.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed))}else t._history.backstack=[];t._updateBackButton(n)},onready:function(i,n){t.dispatchEvent("pageContentReady",{page:i.winControl}),WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide()}}).then(function(){t._lastNavigationPromise==g&&(t._lastNavigationPromise=void 0)});this._lastNavigationPromise=g,i.detail.setPromise(WinJS.Promise.join([r,g]))},_resized:function(t){var n=this;if(this.pageControl&&this.pageControl.element){var n=this,e=this.pageControl,a=e.element;cancelAnimationFrame(n.layoutProcess),n.layoutProcess=requestAnimationFrame(function(){for(var t=i?i.value:null,e=0,o=n.element.children.length;o>e;e++){var r=n.element.children[e].winControl;if(r)if(r.__checkLayout)r.__checkLayout(a,t,n._lastViewstate);else{r.updateLayout&&r.updateLayout.call(r,a,t,n._lastViewstate);var s=a.querySelectorAll(".mcn-layout-ctrl");if(s&&s.length)for(var e=0;e<s.length;e++){var l=s[e].winControl;l.updateLayout&&l.updateLayout(l.element,t,n._lastViewstate)}}}})}this._lastViewstate=i?i.value:null},_handleBack:function(){t.back()},_updateBackButton:function(i){var n=this,e=n.canGoBack,a=null;WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(a=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView()),n.global&&a&&WinJSContrib.UI.enableSystemBackButtonVisibility&&(a.appViewBackButtonVisibility=e?window.Windows.UI.Core.AppViewBackButtonVisibility.visible:window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed);var o=i.querySelectorAll(".win-backbutton, .back-button, .win-navigation-backbutton");if(o&&o.length>0)for(var r=!1,s=0,l=o.length;l>s;s++){var c=o[s];c&&(e&&!r?(c.classList.remove("disabled"),c.disabled=!1):(c.classList.add("disabled"),c.disabled=!0),c.onclick=function(i){if(!i.currentTarget.classList.contains("win-navigation-backbutton"))if(n.global)t.back();else{var e=WinJSContrib.UI.parentNavigator(i.currentTarget);e.back()}})}}}),WinJS.Utilities.eventMixin)}),WinJSContrib.UI.WebComponents&&WinJSContrib.UI.WebComponents.register("mcn-navigator",WinJSContrib.UI.PageControlNavigator,{properties:["global"],map:{ENTERPAGEANIMATION:{attribute:"enterPageAnimation",property:"animations.enterPage",resolve:!0},EXITPAGEANIMATION:{attribute:"exitPageAnimation",property:"animations.exitPage",resolve:!0}}})}();