!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{TileMenu:WinJS.Class.mix(WinJS.Class.define(function(e,t){this.element=e||document.createElement("DIV"),t=t||{},this.items=[],this.element.winControl=this,this.element.classList.add("win-disposable"),this.element.classList.add("mcn-tilemenu"),this.element.style.display="none",this._space=10,WinJS.UI.setOptions(this,t)},{itemTemplate:{get:function(){return this._itemTemplate},set:function(e){this._itemTemplate=WinJSContrib.Utils.getTemplate(e)}},space:{get:function(){return this._space},set:function(e){this._space=e}},show:function(e,t){var i=this;t=t||{},i.sourcePosition=WinJSContrib.UI.offsetFrom(e),i._renderMenu(t.items||i.items),setImmediate(function(){i._layoutItems(t.placement||i.placement,t.fillmode||i.fillmode),i.currentElements.overlay.style.opacity="0",i.currentElements.root.style.opacity="",WinJSContrib.UI.Animation.fadeIn(i.currentElements.overlay,90);var e=i.currentElements.items.map(function(e){return e.element});WinJSContrib.UI.Animation.enterGrow(e,200,{itemdelay:20,maxdelay:150,easing:WinJSContrib.UI.Animation.Easings.easeOutBack})})},hide:function(e){var t=this,i=t.currentElements;if(i){t.currentElements=null,$(".tap",i.root).untap();var n=i.items.map(function(e){return e.element});if(e)var n=n.filter(function(t){return t!=e});var o=[];o.push(WinJSContrib.UI.Animation.fadeOut(i.overlay,160)),o.push(WinJSContrib.UI.Animation.exitShrink(e,260,{delay:140,easing:WinJSContrib.UI.Animation.Easings.easeInBack})),o.push(WinJSContrib.UI.Animation.exitShrink(n,160,{itemdelay:20,maxdelay:100,easing:WinJSContrib.UI.Animation.Easings.easeInBack})),WinJS.Promise.join(o).then(function(){$(i.root).remove()})}},_renderMenuItem:function(e,t){var i=this,n={item:t,element:null,x:0,y:0,w:0,h:0};return n.itemPromise=i.itemTemplate.render(t,n.element).then(function(o){n.element=o.children[0],n.element.classList.add("mcn-tilemenu-menu"),n.element.style.opacity="0",$(n.element).tap(function(e){i.dispatchEvent("iteminvoked",{item:t,target:e}),i.hide(e)}),e.appendChild(n.element)}),n},_renderMenu:function(e){var t=this,i={root:null,overlay:null,itemsContainer:null,items:[]};t.currentElements=i,i.root=document.createElement("DIV"),i.root.className="mcn-tilemenu-container",i.root.style.opacity="0",i.root.id=t.name,i.overlay=document.createElement("DIV"),i.overlay.className="mcn-tilemenu-overlay",i.root.appendChild(i.overlay),t._renderOverlay(),$(i.overlay).tap(function(){t.hide()},{disableAnimation:!0}),i.itemsContainer=document.createElement("DIV"),i.itemsContainer.className="mcn-tilemenu-items",i.root.appendChild(i.itemsContainer),$(i.itemsContainer).tap(function(){t.hide()},{disableAnimation:!0}),e.forEach(function(e,n){i.items.push(t._renderMenuItem(i.itemsContainer,e,n))}),document.body.appendChild(i.root)},_renderOverlay:function(){var e=this,t='<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%"><defs><mask id="maskrect"><rect fill="white" x="0" y="0" width="100%" height="100%"></rect><rect fill="black" x="'+e.sourcePosition.x+'" y="'+e.sourcePosition.y+'" width="'+e.sourcePosition.width+'" height="'+e.sourcePosition.height+'"></rect></mask></defs><rect class="bg" x="0" y="0" width="100%" height="100%" mask="url(&quot;#maskrect&quot;)"></rect></svg>';e.currentElements.overlay.innerHTML=t},_layoutItems:function(e,t){var i=this;e=e||"right",t=t||"clockwise";var n=["right","bottom","left","top"];"clockwise"==t?("top"==e&&(n=["top","right","bottom","left"]),"right"==e&&(n=["right","bottom","left","top"]),"bottom"==e&&(n=["bottom","left","top","right"]),"left"==e&&(n=["left","top","right","bottom"])):"counterclockwise"==t&&("top"==e&&(n=["top","left","bottom","right"]),"right"==e&&(n=["right","top","left","bottom"]),"bottom"==e&&(n=["bottom","right","top","left"]),"left"==e&&(n=["left","bottom","right","top"])),n.current=-1,i._checkLayoutDirection(0,n)},_checkLayoutDirection:function(e,t){var i=this;if(t.current++,!(e>=i.currentElements.items.length)){var n=t[t.current-1],o=t[t.current],s=t[t.current+1],r=i.currentElements.items[e];if("right"==o)if("bottom"==s||"top"==n){var l=i.sourcePosition.y,c=i.sourcePosition.x+i.sourcePosition.width+i._space;i._layoutToBottom(e,c,l,"left",t)}else if("top"==s||"bottom"==n){var l=i.sourcePosition.y+i.sourcePosition.height-r.element.clientHeight,c=i.sourcePosition.x+i.sourcePosition.width+i._space;i._layoutToTop(e,c,l,"left",t)}if("left"==o)if("bottom"==s||"top"==n){var l=i.sourcePosition.y,c=i.sourcePosition.x-i._space;i._layoutToBottom(e,c,l,"right",t)}else if("top"==s||"bottom"==n){var l=i.sourcePosition.y+i.sourcePosition.height-r.element.clientHeight,c=i.sourcePosition.x-i._space;i._layoutToTop(e,c,l,"right",t)}if("bottom"==o)if("left"==s||"right"==n){var l=i.sourcePosition.y+i.sourcePosition.height+i._space,c=i.sourcePosition.x+i.sourcePosition.width-r.element.clientWidth;i._layoutToLeft(e,c,l,"bottom",t)}else if("right"==s||"left"==n){var l=i.sourcePosition.y+i.sourcePosition.height+i._space,c=i.sourcePosition.x;i._layoutToRight(e,c,l,"bottom",t)}if("top"==o)if("left"==s||"right"==n){var l=i.sourcePosition.y-i._space,c=i.sourcePosition.x+i.sourcePosition.width-r.element.clientWidth;i._layoutToLeft(e,c,l,"top",t)}else if("right"==s||"left"==n){var l=i.sourcePosition.y-i._space,c=i.sourcePosition.x;i._layoutToRight(e,c,l,"top",t)}}},_layoutToBottom:function(e,t,i,n,o){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r];if(l.element.style.left="right"==n?t-l.element.clientWidth+"px":t+"px",l.element.style.top=i+"px",i+=l.element.clientHeight+s.space,parseInt(i,10)>parseInt(s.sourcePosition.y+s.sourcePosition.height+s.space+1,10)){s._checkLayoutDirection(r+1,o);break}}},_layoutToTop:function(e,t,i,n,o){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r];if(l.element.style.left="right"==n?t-l.element.clientWidth+"px":t+"px",l.element.style.top=i+"px",i-=l.element.clientHeight+s.space,parseInt(i+l.element.clientHeight+s.space+1,10)<parseInt(s.sourcePosition.y,10)){s._checkLayoutDirection(r+1,o);break}}},_layoutToRight:function(e,t,i,n,o){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r];if(l.element.style.left=t+"px",l.element.style.top="top"==n?i-l.element.clientHeight+"px":i+"px",t+=l.element.clientWidth+s.space,parseInt(t,10)>parseInt(s.sourcePosition.x+s.sourcePosition.width+s.space+1,10)){s._checkLayoutDirection(r+1,o);break}}},_layoutToLeft:function(e,t,i,n,o){for(var s=this,r=e;r<s.currentElements.items.length;r++){var l=s.currentElements.items[r],c=s.currentElements.items[r+1],a=0;if(c&&(a=c.element.clientWidth),l.element.style.left=t+"px",l.element.style.top="top"==n?i-l.element.clientHeight+"px":i+"px",t-=l.element.clientWidth+s.space,parseInt(t+a+s.space+1,10)<parseInt(s.sourcePosition.x,10)){s._checkLayoutDirection(r+1,o);break}}},dispose:function(){WinJS.Utilities.disposeSubTree(this.element)}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("iteminvoked"))})}();