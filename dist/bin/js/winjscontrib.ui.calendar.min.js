/* 
 * WinJS Contrib v2.1.0.5
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},WinJSContrib;!function(t){var e;!function(e){var n=function(){function e(e,n){var i=this;this.element=e||document.createElement("DIV"),n=n||{},this.element.winControl=this,this.element.classList.add("mcn-datepicker"),this.element.classList.add("win-disposable"),this.flyout=new WinJS.UI.Flyout,this.flyout.element.classList.add("mcn-datepicker-flyout"),this.element.appendChild(this.flyout.element),n.hasOwnProperty("deferRendering")||(n.deferRendering=!0);var r=document.createElement("DIV");this.flyout.element.appendChild(r),this.calendar=new t.UI.Calendar(r,n),this.calendar.onchange=function(){i.value=i.calendar.value},this.textElement=document.createElement("DIV"),this.textElement.className="mcn-datepicker-text",this.element.appendChild(this.textElement),this.element.tabIndex=0,this.element.setAttribute("role","button"),this.textElement.onclick=function(){i.flyout.show(i.textElement)},WinJS.UI.setOptions(this,n),this.value||(this.value=new Date)}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this.calendar.value=t,this.textElement.innerText=moment(t).format("ll"),this.flyout.hide()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){WinJS.Utilities.disposeSubTree(this.element)},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e}();e.DatePickerControl=n,e.DatePicker=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(n),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var i=function(){function e(e,n){var i=this;if(this.element=e||document.createElement("DIV"),n=n||{},this._startDayOfWeek=1,this.element.winControl=this,this.element.classList.add("mcn-calendar"),this.element.classList.add("win-disposable"),WinJS.UI.setOptions(this,n),this._ready=!1,n.deferRendering){var r=t.Utils.getScopeControl(this.element);r&&r.readyComplete&&r.readyComplete.then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){i.render()},WinJS.Utilities.Scheduler.Priority.idle)}),setTimeout(function(){WinJS.Utilities.Scheduler.schedule(function(){i.render()},WinJS.Utilities.Scheduler.Priority.idle)},2e3)}else this.render()}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){"string"==typeof t&&(t=moment(t).toDate()),this._value=t,this._currentPanel&&(this._currentPanel._currentDate=new Date(t.getFullYear(),t.getMonth(),1),this._currentPanel.ensureValue())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDayOfWeek",{get:function(){return this._startDayOfWeek},set:function(t){this._startDayOfWeek=t},enumerable:!0,configurable:!0}),e.prototype.render=function(){var e=this;if(!this._ready){this._ready=!0,this.wrapper=document.createElement("DIV"),this.wrapper.className="mcn-calendar-wrapper",this.element.appendChild(this.wrapper),this.panelsContainer=document.createElement("DIV"),this.panelsContainer.className="mcn-calendar-panels",this.wrapper.appendChild(this.panelsContainer),this.navbuttons=document.createElement("DIV"),this.navbuttons.className="navbuttons",this.wrapper.appendChild(this.navbuttons),this.navbuttonPrevious=document.createElement("BUTTON"),this.navbuttonPrevious.className="navbutton navbutton-previous",this.navbuttons.appendChild(this.navbuttonPrevious),t.UI.tap(this.navbuttonPrevious,function(){e._currentPanel&&e._currentPanel.previous()}),this.navbuttonNext=document.createElement("BUTTON"),this.navbuttonNext.className="navbutton navbutton-next",this.navbuttons.appendChild(this.navbuttonNext),t.UI.tap(this.navbuttonNext,function(){e._currentPanel&&e._currentPanel.next()});var n=this.value;n||(n=this.mindate?moment(this.mindate).toDate():new Date),this._daysPanel=new a(this,n),this._currentPanel=this._daysPanel,this._currentPanel.currentChanged=function(){e.checkState()},this.checkState(),this.element.onmousewheel=function(t){t.preventDefault(),t.stopPropagation(),t.wheelDelta<0?e._currentPanel.allowNext()&&e._currentPanel.next():e._currentPanel.allowPrevious()&&e._currentPanel.previous()}}},e.prototype.checkState=function(){this.navbuttonNext.disabled=this._currentPanel.allowNext()?!1:!0,this.navbuttonPrevious.disabled=this._currentPanel.allowPrevious()?!1:!0},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e.prototype.switchToMonth=function(){this._currentPanel!=this._monthsPanel&&this._currentPanel.hide(),this._monthsPanel?(this._monthsPanel._currentDate=this._currentPanel._currentDate,this._monthsPanel.ensureValue(!0)):this._monthsPanel=new s(this,this._currentPanel._currentDate),this._monthsPanel.show(),this._currentPanel=this._monthsPanel,this.checkState()},e.prototype.switchToDays=function(){this._currentPanel!=this._daysPanel&&this._currentPanel.hide(),this._daysPanel._currentDate=this._currentPanel._currentDate,this._daysPanel.ensureValue(!0),this._daysPanel.show(),this._currentPanel=this._daysPanel,this.checkState()},e}();e.CalendarControl=i,e.Calendar=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(i),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var r=function(){function t(t,e){this.parent=t,this.element=document.createElement("DIV"),this.element.className="calendar-panel",this.parent.panelsContainer.appendChild(this.element),this._currentDate=new Date(e.getFullYear(),e.getMonth(),1)}return t.prototype.next=function(){},t.prototype.previous=function(){},t.prototype.allowNext=function(){return!1},t.prototype.allowPrevious=function(){return!1},t.prototype.ensureValue=function(t){},t.prototype.hide=function(){var t=this;return WinJS.UI.Animation.drillInOutgoing(this.element).then(function(){t.element.classList.add("disabled")})},t.prototype.show=function(){return this.element.classList.remove("disabled"),WinJS.UI.Animation.drillInIncoming(this.element)},t}();e.CalendarPanelControl=r;var a=function(e){function n(t,n){e.call(this,t,n),this.element.classList.add("day-panel"),this.elementContent=document.createElement("DIV"),this.elementContent.className="calendar-panel-content",this.element.appendChild(this.elementContent),this._currentItem=new o(this,this.currentDate)}return __extends(n,e),Object.defineProperty(n.prototype,"currentDate",{get:function(){return this._currentDate},enumerable:!0,configurable:!0}),n.prototype.ensureValue=function(t){0!=moment(this.currentDate).diff(this._currentItem.currentDate)&&this.update(function(t){return WinJS.UI.Animation.drillInIncoming(t)},function(t){return WinJS.UI.Animation.drillInOutgoing(t)},t)},n.prototype.update=function(t,e,n){this._currentItem.currentDate=moment(this._currentDate),this._currentItem.generateDays(t,e,n),this.parent.checkState()},n.prototype.next=function(){this._currentDate=moment(this._currentDate).add(1,"M").toDate(),this.update(function(e){return t.UI.Animation.slideFromBottom(e,{duration:160})},function(e){return t.UI.Animation.slideToTop(e,{duration:160})})},n.prototype.previous=function(){this._currentDate=moment(this._currentDate).add(-1,"M").toDate(),this._currentItem.currentDate=moment(this._currentDate),this.update(function(e){return t.UI.Animation.slideFromTop(e,{duration:160})},function(e){return t.UI.Animation.slideToBottom(e,{duration:160})})},n.prototype.allowNext=function(){if(!this.parent.maxdate)return!0;var t=moment(this._currentDate).add(1,"M").add(-1,"d").toDate();return t<moment(this.parent.maxdate).toDate()?!0:!1},n.prototype.allowPrevious=function(){return this.parent.mindate?this._currentDate>moment(this.parent.mindate).toDate()?!0:!1:!0},n}(r);e.CalendarDayPanelControl=a;var o=function(){function e(t,e){this.parent=t,this.currentDate=moment(new Date(e.getFullYear(),e.getMonth(),1)),this.element=document.createElement("DIV"),this.element.className="calendar-panel-item day-panel-item",this.element.id="month"+this.currentDate.toDate().toISOString(),this.parent.elementContent.appendChild(this.element),this.renderContent()}return e.prototype.enter=function(t){return(t=t||WinJS.UI.Animation.drillOutIncoming)(this.element)},e.prototype.renderContent=function(){var e=this,n=this.currentDate.clone().day(this.parent.parent.startDayOfWeek);this.element.innerHTML='<header>\n					<div class="month">'+this.currentDate.format("MMMM")+'</div>\n					<div class="year">'+this.currentDate.format("YYYY")+'</div>\n				</header>\n				<section class="day-items">\n					<header>\n					</header>\n					<section>\n					</section>\n				</section>',this.monthTxt=this.element.querySelector(".month"),this.yearTxt=this.element.querySelector(".year");var i=this.element.querySelector("header");t.UI.tap(i,function(){e.parent.parent.switchToMonth()}),this.header=this.element.querySelector(".day-items > header");for(var r=n.clone(),a=0;7>a;a++){var o=document.createElement("DIV");o.className="day-item day-header",o.innerText=r.format("ddd");var s=r.day();(0==s||6==s)&&o.classList.add("weekend"),this._lastdow=r.day(),r.add(1,"d"),this.header.appendChild(o)}this.content=this.element.querySelector(".day-items > section"),this.days=this.renderDaysWrapper(this.content)},e.prototype.destroyPanel=function(t){WinJS.Utilities.disposeSubTree(t),t.winControl.dispose(),t.parentElement.removeChild(t)},e.prototype.generateDays=function(t,e,n){var i=this;if(this.days){var r=this.days;n?this.destroyPanel(r):e(r).then(function(){i.destroyPanel(r)})}this.selected=null,this.days=this.renderDaysWrapper(this.content),n?(this.monthTxt.innerText=this.currentDate.format("MMMM"),this.yearTxt.innerText=this.currentDate.format("YYYY")):t(this.days).then(function(){i.monthTxt.innerText=i.currentDate.format("MMMM"),i.yearTxt.innerText=i.currentDate.format("YYYY")})},e.prototype.renderDaysWrapper=function(e){var n=this,i=document.createElement("DIV");i.className="day-items-wrapper";var r=new t.UI.SwipeSlide(i,{direction:"vertical",allowed:{top:this.parent.allowNext(),bottom:this.parent.allowPrevious()}});return r.onswipe=function(t){r.swipeHandled=!0,"top"==t.direction?n.parent.next():"bottom"==t.direction&&n.parent.previous()},this.renderDays(i),e.appendChild(i),i},e.prototype.renderDays=function(e){var n=this,i=this.currentDate.clone().day(this.parent.parent.startDayOfWeek),r=this.currentDate.month(),a=this.parent.parent.value,o=moment(a),s=(moment(this.parent.parent.value).hour(0).minute(0).second(0).millisecond(0),null),l=moment().hour(0).minute(0).second(0).millisecond(0);this.parent.parent.mindate&&(s=moment(this.parent.parent.mindate).hour(0).minute(0).second(0).millisecond(0));var h=null;this.parent.parent.maxdate&&(h=moment(this.parent.parent.maxdate).hour(0).minute(0).second(0).millisecond(0));var u=i.clone(),c=this.currentDate.clone().add(1,"M").add(-1,"d");c.day()!=this._lastdow&&c.day(this._lastdow+7);for(;c>=u;){var d=document.createElement("BUTTON");d.className="day-item",d.id="day-"+u.format("YYYY-MM-DD"),d.innerText=u.format("DD"),0==u.diff(l)&&d.classList.add("today"),a&&0==u.diff(o)&&(d.classList.add("selected"),this.selected=d);var m=u.day();(0==m||6==m)&&d.classList.add("weekend"),u.month()!=r&&d.classList.add("notthismonth"),s&&s>u&&(d.disabled=!0),h&&u>h&&(d.disabled=!0),d.mcnCalendarDay=u.clone(),t.UI.tap(d,function(t){var e=t.mcnCalendarDay;t.classList.add("selected"),n.selected&&n.selected.classList.remove("selected"),n.selected=t,n.parent.parent.value=e.toDate(),n.parent.parent.dispatchEvent("change")}),u.add(1,"d"),e.appendChild(d)}},e.prototype.remove=function(e){var n=this;return e=e||WinJS.UI.Animation.drillOutOutgoing,this.element?e(this.element).then(function(){t.UI.untapAll(n.element),n.element.parentElement.removeChild(n.element),n.element=null}):WinJS.Promise.wrap()},e}();e.CalendarDayPanelContentControl=o;var s=function(e){function n(t,n){e.call(this,t,n),this.element.classList.add("month-panel"),this.renderContent()}return __extends(n,e),n.prototype.next=function(){this._currentDate=moment(this._currentDate).add(1,"Y").toDate(),this.update(function(e){return t.UI.Animation.slideFromBottom(e,{duration:160})},function(e){return t.UI.Animation.slideToTop(e,{duration:160})})},n.prototype.previous=function(){this._currentDate=moment(this._currentDate).add(-1,"Y").toDate(),this.update(function(e){return t.UI.Animation.slideFromTop(e,{duration:160})},function(e){return t.UI.Animation.slideToBottom(e,{duration:160})})},n.prototype.allowNext=function(){var t=new Date(this._currentDate.getFullYear(),11,31);return this.parent.maxdate?t<moment(this.parent.maxdate).toDate()?!0:!1:!0},n.prototype.allowPrevious=function(){var t=new Date(this._currentDate.getFullYear(),0,1);return this.parent.mindate?t>moment(this.parent.mindate).month(0).date(1).toDate()?!0:!1:!0},n.prototype.ensureValue=function(t){0!=moment(this._currentDate).diff(moment(this.renderedDate))&&this.update(function(t){return WinJS.UI.Animation.drillInIncoming(t)},function(t){return WinJS.UI.Animation.drillInOutgoing(t)},t)},n.prototype.update=function(t,e,n){var i=this,r=this.monthesPanel;n?r.parentElement.removeChild(r):e(this.monthesPanel).then(function(){r.parentElement.removeChild(r)}),this.monthesPanel=this.renderMonthPanel(this.content),n?this.yearTxt.innerText=""+this._currentDate.getFullYear():t(this.monthesPanel).then(function(){i.yearTxt.innerText=""+i._currentDate.getFullYear()}),this.parent.checkState()},n.prototype.renderContent=function(){this.element.innerHTML='<header>\n					<div class="year">'+this._currentDate.getFullYear()+'</div>\n				</header>\n				<section class="month-items">\n					\n				</section>',this.yearTxt=this.element.querySelector(".year"),this.content=this.element.querySelector(".month-items"),this.monthesPanel=this.renderMonthPanel(this.content)},n.prototype.renderMonthPanel=function(e){var n=this,i=document.createElement("DIV");i.className="month-itemspanel";var r=new t.UI.SwipeSlide(i,{direction:"vertical",allowed:{top:this.allowNext(),bottom:this.allowPrevious()}});r.onswipe=function(t){r.swipeHandled=!0,"top"==t.direction?n.next():"bottom"==t.direction&&n.previous()};var a=moment(new Date(this._currentDate.getFullYear(),0,1)),o=moment().hour(0).minute(0).second(0).millisecond(0),s=o.clone().date(1),l=null;this.parent.mindate&&(l=moment(this.parent.mindate).date(1).hour(0).minute(0).second(0).millisecond(0));var h=null;this.parent.maxdate&&(h=moment(this.parent.maxdate).date(1).hour(0).minute(0).second(0).millisecond(0));for(var u=0;12>u;u++){var c=document.createElement("BUTTON");c.className="month-item";var d=a.clone();c.mcnMonthDate=d,c.innerText=d.format("MMM"),0==d.diff(s)?c.classList.add("today"):o>a&&c.classList.add("pastmonth"),l&&l>a&&(c.disabled=!0),h&&a>h&&(c.disabled=!0),t.UI.tap(c,function(t){var e=t.mcnMonthDate;n._currentDate=e.toDate(),n.parent.switchToDays()}),i.appendChild(c),a.add(1,"M")}return e.appendChild(i),this.renderedDate=this._currentDate,i},n}(r);e.CalendarMonthPanelControl=s}(e=t.UI||(t.UI={}))}(WinJSContrib||(WinJSContrib={}));