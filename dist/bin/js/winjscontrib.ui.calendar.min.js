/* 
 * WinJS Contrib v2.1.0.4
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var __extends=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var a in e)e.hasOwnProperty(a)&&(t[a]=e[a]);n.prototype=e.prototype,t.prototype=new n},WinJSContrib;!function(t){var e;!function(e){var n=function(){function e(e,n){var a=this;this.element=e||document.createElement("DIV"),n=n||{},this.element.winControl=this,this.element.classList.add("mcn-datepicker"),this.element.classList.add("win-disposable"),this.flyout=new WinJS.UI.Flyout,this.element.appendChild(this.flyout.element),this.calendar=new t.UI.Calendar,this.flyout.element.appendChild(this.calendar.element),this.flyout.element.classList.add("mcn-datepicker-flyout"),this.calendar.onchange=function(){a.value=a.calendar.value},this.textElement=document.createElement("DIV"),this.textElement.className="mcn-datepicker-text",this.element.appendChild(this.textElement),t.UI.tap(this.textElement,function(){a.flyout.show(a.textElement)}),WinJS.UI.setOptions(this,n),this.value||(this.value=new Date)}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this.calendar.value=t,this.textElement.innerText=moment(t).format("ll"),this.flyout.hide()},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){WinJS.Utilities.disposeSubTree(this.element)},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e}();e.DatePickerControl=n,e.DatePicker=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(n),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var a=function(){function e(e,n){var a=this;this.element=e||document.createElement("DIV"),n=n||{},this._startDayOfWeek=1,this._value=new Date,this.element.winControl=this,this.element.classList.add("mcn-calendar"),this.element.classList.add("win-disposable"),this.wrapper=document.createElement("DIV"),this.wrapper.className="mcn-calendar-wrapper",this.element.appendChild(this.wrapper),this.panelsContainer=document.createElement("DIV"),this.panelsContainer.className="mcn-calendar-panels",this.wrapper.appendChild(this.panelsContainer),this.navbuttons=document.createElement("DIV"),this.navbuttons.className="navbuttons",this.wrapper.appendChild(this.navbuttons),this.navbuttonPrevious=document.createElement("BUTTON"),this.navbuttonPrevious.className="navbutton navbutton-previous",this.navbuttons.appendChild(this.navbuttonPrevious),t.UI.tap(this.navbuttonPrevious,function(){a._currentPanel&&a._currentPanel.previous()}),this.navbuttonNext=document.createElement("BUTTON"),this.navbuttonNext.className="navbutton navbutton-next",this.navbuttons.appendChild(this.navbuttonNext),t.UI.tap(this.navbuttonNext,function(){a._currentPanel&&a._currentPanel.next()}),WinJS.UI.setOptions(this,n),this._currentPanel=new r(this,this.value),this._currentPanel.currentChanged=function(){a.checkState()}}return Object.defineProperty(e.prototype,"value",{get:function(){return this._value},set:function(t){this._value=t,this._currentPanel&&(this._currentPanel._currentDate=new Date(t.getFullYear(),t.getMonth(),1),this._currentPanel.ensureValue())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDayOfWeek",{get:function(){return this._startDayOfWeek},set:function(t){this._startDayOfWeek=t},enumerable:!0,configurable:!0}),e.prototype.render=function(){},e.prototype.checkState=function(){},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e}();e.CalendarControl=a;var i=function(){function t(t,e){this.parent=t,this.element=document.createElement("DIV"),this.element.className="calendar-panel",this.parent.panelsContainer.appendChild(this.element),this._currentDate=new Date(e.getFullYear(),e.getMonth(),1)}return t.prototype.next=function(){},t.prototype.previous=function(){},t.prototype.allowNext=function(){return!1},t.prototype.allowPrevious=function(){return!1},t.prototype.ensureValue=function(){},t}();e.CalendarPanelControl=i;var r=function(e){function n(t,n){e.call(this,t,n),this.element.classList.add("day-panel"),this.elementContent=document.createElement("DIV"),this.elementContent.className="calendar-panel-content",this.element.appendChild(this.elementContent),this._currentItem=new s(this,this.currentDate)}return __extends(n,e),Object.defineProperty(n.prototype,"currentDate",{get:function(){return this._currentDate},enumerable:!0,configurable:!0}),n.prototype.ensureValue=function(){0!=moment(this.currentDate).diff(this._currentItem.currentDate)&&this.update(function(t){return WinJS.UI.Animation.drillInIncoming(t)},function(t){return WinJS.UI.Animation.drillInOutgoing(t)})},n.prototype.update=function(t,e){this._currentItem.currentDate=moment(this._currentDate),this._currentItem.generateDays(t,e),this.parent.checkState()},n.prototype.next=function(){this._currentDate=moment(this._currentDate).add(1,"M").toDate(),this.update(function(e){return t.UI.Animation.slideFromBottom(e,{duration:160})},function(e){return t.UI.Animation.slideToTop(e,{duration:160})})},n.prototype.previous=function(){this._currentDate=moment(this._currentDate).add(-1,"M").toDate(),this._currentItem.currentDate=moment(this._currentDate),this.update(function(e){return t.UI.Animation.slideFromTop(e,{duration:160})},function(e){return t.UI.Animation.slideToBottom(e,{duration:160})})},n.prototype.allowNext=function(){return!0},n.prototype.allowPrevious=function(){return!0},n}(i);e.CalendarDayPanelControl=r;var s=function(){function e(t,e){this.parent=t,this.currentDate=moment(new Date(e.getFullYear(),e.getMonth(),1)),this.element=document.createElement("DIV"),this.element.className="calendar-panel-item day-panel-item",this.element.id="month"+this.currentDate.toDate().toISOString(),this.parent.elementContent.appendChild(this.element),this.renderContent()}return e.prototype.enter=function(t){return(t=t||WinJS.UI.Animation.drillOutIncoming)(this.element)},e.prototype.renderContent=function(){var t=this.currentDate.clone().day(this.parent.parent.startDayOfWeek);this.element.innerHTML='<header>\n					<div class="month">'+this.currentDate.format("MMMM")+'</div>\n					<div class="year">'+this.currentDate.format("YYYY")+'</div>\n				</header>\n				<section class="day-items">\n					<header>\n					</header>\n					<section>\n					</section>\n				</section>',this.monthTxt=this.element.querySelector(".month"),this.yearTxt=this.element.querySelector(".year"),this.header=this.element.querySelector(".day-items > header");for(var e=t.clone(),n=0;7>n;n++){var a=document.createElement("DIV");a.className="day-item day-header",a.innerText=e.format("ddd");var i=e.day();(0==i||6==i)&&a.classList.add("weekend"),this._lastdow=e.day(),e.add(1,"d"),this.header.appendChild(a)}this.content=this.element.querySelector(".day-items > section"),this.days=this.renderDaysWrapper(this.content)},e.prototype.generateDays=function(t,e){var n=this;if(this.days){var a=this.days;e(a).then(function(){a.parentElement.removeChild(a)})}this.selected=null,this.days=this.renderDaysWrapper(this.content),t(this.days).then(function(){n.monthTxt.innerText=n.currentDate.format("MMMM"),n.yearTxt.innerText=n.currentDate.format("YYYY")})},e.prototype.renderDaysWrapper=function(t){var e=document.createElement("DIV");return e.className="day-items-wrapper",this.renderDays(e),t.appendChild(e),e},e.prototype.renderDays=function(e){var n=this,a=this.currentDate.clone().day(this.parent.parent.startDayOfWeek),i=this.currentDate.month(),r=moment(this.parent.parent.value).hour(0).minute(0).second(0).millisecond(0),s=null;this.parent.parent.minDate&&(s=moment(this.parent.parent.minDate));var o=null;this.parent.parent.maxDate&&(o=moment(this.parent.parent.maxDate));var l=a.clone(),c=this.currentDate.clone().add(1,"M").add(-1,"d");c.day()!=this._lastdow&&c.day(this._lastdow+7);for(;c>=l;){var u=document.createElement("BUTTON");u.className="day-item",u.id="day-"+l.format("YYYY-MM-DD"),u.innerText=l.format("DD"),0==l.diff(r)&&(u.classList.add("selected"),this.selected=u);var h=l.day();(0==h||6==h)&&u.classList.add("weekend"),l.month()!=i&&u.classList.add("notthismonth"),u.mcnCalendarDay=l.clone(),t.UI.tap(u,function(t){var e=t.mcnCalendarDay;t.classList.add("selected"),n.selected&&n.selected.classList.remove("selected"),n.selected=t,n.parent.parent.value=e.toDate(),n.parent.parent.dispatchEvent("change")}),l.add(1,"d"),e.appendChild(u)}},e.prototype.remove=function(e){var n=this;return e=e||WinJS.UI.Animation.drillOutOutgoing,this.element?e(this.element).then(function(){t.UI.untapAll(n.element),n.element.parentElement.removeChild(n.element),n.element=null}):WinJS.Promise.wrap()},e}();e.CalendarDayPanelContentControl=s,e.Calendar=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(a),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change")),e.CalendarDayPanel=WinJS.Class.mix(r,WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("selected"))}(e=t.UI||(t.UI={}))}(WinJSContrib||(WinJSContrib={}));