/* 
 * WinJS Contrib v2.1.0.6
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

var __extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},WinJSContrib;!function(t){var e;!function(e){var i=[1,2,3,4,5,6,7,8,9,10,11,12],n=[12,1,2,3,4,5,6,7,8,9,10,11],s=[13,14,15,16,17,18,19,20,21,22,23,0],r=[0,13,14,15,16,17,18,19,20,21,22,23],o=[5,10,15,20,25,30,35,40,45,50,55,0],a=[0,5,10,15,20,25,30,35,40,45,50,55],l=function(){function e(e,i){var n=this;this.element=e||document.createElement("DIV"),i=i||{},this.element.winControl=this,this.element.classList.add("mcn-timepicker"),this.element.classList.add("win-disposable"),this.flyout=new WinJS.UI.Flyout,this.flyout.element.classList.add("mcn-timepicker-flyout"),this.element.appendChild(this.flyout.element),i.hasOwnProperty("deferRendering")||(i.deferRendering=!0);var s=document.createElement("DIV");this.flyout.element.appendChild(s);var r=JSON.parse(JSON.stringify(i));r.flyout=this.flyout,this.timeclock=new t.UI.TimeClock(s,r),this.timeclock.element.onmousewheel=function(t){t.preventDefault(),t.stopPropagation()},this.timeclock.onchange=function(){n.value=n.timeclock.value,n.flyout.hide()},this.timeclock.onhourchange=function(){n.value=n.timeclock.value},this.flyout.onbeforeshow=function(){setImmediate(function(){n.timeclock.setFocus()})},this.flyout.onafterhide=function(){n.timeclock.switchToHours()},this.textElement=document.createElement("DIV"),this.textElement.className="mcn-timepicker-text tap",this.element.appendChild(this.textElement),this.textElement.tabIndex=0,this.textElement.setAttribute("role","button"),this.textElement.onclick=function(t){t.preventDefault(),t.stopPropagation(),n.flyout.show(n.textElement)},this.textElement.innerText=this.timeclock.value,WinJS.UI.setOptions(this,i)}return Object.defineProperty(e.prototype,"value",{get:function(){return this.timeclock.value},set:function(t){try{this.timeclock.value=t}catch(e){console.error(e)}this.textElement.innerText=this.timeclock.value},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueAsDate",{get:function(){return this.timeclock.valueAsDate},set:function(t){this.timeclock.valueAsDate=t,this.textElement.innerText=this.timeclock.value},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){WinJS.Utilities.disposeSubTree(this.element)},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e}();e.TimePickerControl=l,e.TimePicker=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(l),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change"));var u=function(){function e(e,i){var n=this;if(this.element=e||document.createElement("DIV"),i=i||{},this.element.winControl=this,this.element.classList.add("mcn-timeclock"),this.element.classList.add("win-disposable"),this.eventTracker=new t.UI.EventTracker,i.radial&&this.element.classList.add("radial"),i.value||(this.valueAsDate=new Date),WinJS.UI.setOptions(this,i),this.flyout&&(this.element.classList.add("win-xyfocus-suspended"),this.eventTracker.addEvent(this.element,"keydown",this.onkeydown.bind(this),!0)),i.deferRendering){var s=t.Utils.getScopeControl(this.element);s?s.readyComplete&&s.readyComplete.then(function(){return WinJS.Promise.timeout(200)}).then(function(){WinJS.Utilities.Scheduler.schedule(function(){n.render()},WinJS.Utilities.Scheduler.Priority.idle)}):setTimeout(function(){WinJS.Utilities.Scheduler.schedule(function(){n.render()},WinJS.Utilities.Scheduler.Priority.idle)},2e3)}else this.render()}return e.prototype.render=function(){var e=this;this.element.innerHTML='<header>\n                    <button class="hours current">'+t.Utils.pad2(this.hour)+'</button>\n                    <div class="sep">:</div>\n                    <button class="minutes">'+t.Utils.pad2(this.minutes)+"</button>\n                </header>\n                <section>\n                </section>",this.header=this.element.querySelector("header"),this.content=this.element.querySelector("section"),this.hoursElt=this.element.querySelector(".hours"),t.UI.tap(this.hoursElt,function(){e.switchToHours()}),this.minutesElt=this.element.querySelector(".minutes"),t.UI.tap(this.minutesElt,function(){e.switchToMinutes()}),this.amLabel=this.amLabel||"AM",this.pmLabel=this.pmLabel||"PM",this.hoursPanel=new c(this),this.currentPanel=this.hoursPanel},e.prototype.onkeydown=function(t){if("PageDown"==t.key)this.toggleDisplay(),t.preventDefault(),t.stopPropagation();else if("PageUp"==t.key)this.toggleDisplay(),t.preventDefault(),t.stopPropagation();else if("Down"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("down",{focusRoot:this.element});e?e.focus():this.currentPanel==this.hoursPanel&&this.hoursPanel.toggleView(),t.preventDefault(),t.stopPropagation()}else if("Up"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("up",{focusRoot:this.element});e?e.focus():this.currentPanel==this.hoursPanel&&this.hoursPanel.toggleView(),t.preventDefault(),t.stopPropagation()}else if("Left"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("left",{focusRoot:this.element});e&&e.focus(),t.preventDefault(),t.stopPropagation()}else if("Right"==t.key){var e=WinJS.UI.XYFocus.findNextFocusElement("right",{focusRoot:this.element});e&&e.focus(),t.preventDefault(),t.stopPropagation()}},Object.defineProperty(e.prototype,"value",{get:function(){return t.Utils.pad2(this.hour)+":"+t.Utils.pad2(this.minutes)},set:function(t){var e=t.split(":");this._value=moment(this._value).hour(parseInt(e[0],10)).minute(parseInt(e[1],10)).toDate(),this.updateDisplay()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"valueAsDate",{get:function(){return this._value},set:function(t){this._value=moment(t).toDate(),this.updateDisplay()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hour",{get:function(){return this._value.getHours()},set:function(t){this._value=moment(this._value).hour(t).toDate(),this.updateDisplay(),this.dispatchEvent("hourchange")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"minutes",{get:function(){return this._value.getMinutes()},set:function(t){this._value=moment(this._value).minute(t).toDate(),this.updateDisplay(),this.dispatchEvent("change"),this.dispatchEvent("minutechange")},enumerable:!0,configurable:!0}),e.prototype.conformMinutes=function(){for(var t=this._value.getMinutes()||0,e=0;10>e&&t%5!=0;)t-=1,e++;this._value=moment(this._value).minute(t).toDate()},e.prototype.updateDisplay=function(){this.conformMinutes(),this.hoursElt&&(this.hoursElt.innerText=t.Utils.pad2(this.hour),this.minutesElt.innerText=t.Utils.pad2(this.minutes)),this.currentPanel&&this.currentPanel.ensureValue()},e.prototype.toggleDisplay=function(){this.currentPanel==this.hoursPanel?this.switchToMinutes():this.switchToHours()},e.prototype.setFocus=function(){this.currentPanel&&this.currentPanel.setFocus()},e.prototype.switchToHours=function(){return this.currentPanel==this.hoursPanel?void this.hoursPanel.ensureValue():(this.currentPanel&&this.currentPanel!=this.hoursPanel&&this.currentPanel.remove(),this.hoursPanel?this.hoursPanel.ensureValue():this.hoursPanel=new c(this),this.minutesElt.classList.remove("current"),this.hoursElt.classList.add("current"),this.hoursPanel.show(),this.hoursPanel.setFocus(),void(this.currentPanel=this.hoursPanel))},e.prototype.switchToMinutes=function(){return this.currentPanel==this.minutesPanel?void this.minutesPanel.ensureValue():(this.currentPanel&&this.currentPanel!=this.minutesPanel&&this.currentPanel.remove(),this.minutesPanel?this.minutesPanel.ensureValue():this.minutesPanel=new m(this),this.minutesElt.classList.add("current"),this.hoursElt.classList.remove("current"),this.minutesPanel.show(),this.minutesPanel.setFocus(),void(this.currentPanel=this.minutesPanel))},e.prototype.dispatchEvent=function(t,e){},e.prototype.addEventListener=function(t,e){},e.prototype.dispose=function(){this.eventTracker.dispose()},e}();e.TimeClockControl=u,e.TimeClock=WinJS.Class.mix(WinJS.Utilities.markSupportedForProcessing(u),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("change","hourchange","minutechange"));var h=function(){function e(t){this.parent=t,this.element=document.createElement("DIV"),this.element.className="timepanel",this.element.innerHTML="<header>\n                </header>\n                <section>\n                </section>",this.header=this.element.querySelector("header"),this.content=this.element.querySelector("section"),this.parent.content.appendChild(this.element)}return e.prototype.renderItems=function(e,i,n,s,r){var o=document.createElement("DIV");o.className="itemspanel";var a=document.createElement("DIV");return a.className="items",o.appendChild(a),e.forEach(function(e){var r=document.createElement("BUTTON");r.className="timeitem item-"+i,r.id=i+e,r.dataset.val=""+e,r.innerText=t.Utils.pad2(e),e==n&&r.classList.add("selected"),r.onclick=s,a.appendChild(r)}),this.parent.radial&&this.radialLayout(a),o},e.prototype.radialLayout=function(t){for(var e,i,n=80,s=130,r=38,o=0;12>o;o++){var a=t.children[o];e=o/6*Math.PI,i=n,a.style.left=s+Math.sin(e)*i-r+"px",a.style.top=s-Math.cos(e)*i-r+"px"}},e.prototype.remove=function(){var t=this;return WinJS.UI.Animation.drillInOutgoing(this.element).then(function(){t.element.classList.add("hidden"),t.element.style.display="none"})},e.prototype.show=function(){return this.element.classList.remove("hidden"),this.element.style.display="",WinJS.UI.Animation.drillInIncoming(this.element)},e.prototype.ensureValue=function(){},e.prototype.setFocus=function(){},e}();e.TimePanel=h;var c=function(e){function o(i){e.call(this,i),this.element.classList.add("hourspanel"),this.header.innerHTML='<button class="hoursel am">'+this.parent.amLabel+'</button>\n                <button class="hoursel pm">'+this.parent.pmLabel+"</button>",this.amButton=this.header.querySelector(".hoursel.am"),this.pmButton=this.header.querySelector(".hoursel.pm"),t.UI.tap(this.amButton,this.setAM.bind(this)),t.UI.tap(this.pmButton,this.setPM.bind(this)),this.init()}return __extends(o,e),o.prototype.init=function(){var t=this.parent.hour;if(0==t||t>12){var e=this.parent.radial?r:s;this.pmButton.classList.add("selected"),this.isAm=!1}else{var e=this.parent.radial?n:i;this.amButton.classList.add("selected"),this.isAm=!0}this.currentHours=this.renderItems(e,"hour",t,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours)},o.prototype.ensureValue=function(){var t=this.element.querySelector(".item-hour.selected");if(t){var e=parseInt(t.dataset.val,10);e!=this.parent.hour&&(t.classList.remove("selected"),this.currentHours.parentElement.removeChild(this.currentHours),this.init())}},o.prototype.toggleView=function(){this.isAm?this.setPM():this.setAM()},o.prototype.setFocus=function(){var t=this.currentHours.querySelector(".item-hour.selected");t||(t=t=this.currentHours.querySelector(".item-hour")),t&&t.focus()},o.prototype.setPM=function(){if(this.isAm){var t=this.currentHours;WinJS.UI.Animation.drillInOutgoing(t).then(function(){t.parentElement.removeChild(t)}),this.isAm=!1;var e=this.parent.radial?r:s;this.pmButton.classList.add("selected"),this.amButton.classList.remove("selected"),this.currentHours=this.renderItems(e,"hour",this.parent.hour,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours),this.setFocus(),WinJS.UI.Animation.drillInIncoming(this.currentHours)}},o.prototype.setAM=function(){if(!this.isAm){var t=this.currentHours;WinJS.UI.Animation.drillInOutgoing(t).then(function(){t.parentElement.removeChild(t)}),this.isAm=!0;var e=this.parent.radial?n:i;this.pmButton.classList.remove("selected"),this.amButton.classList.add("selected"),this.currentHours=this.renderItems(e,"hour",this.parent.hour,this.hourClicked.bind(this)),this.content.appendChild(this.currentHours),this.setFocus(),WinJS.UI.Animation.drillInIncoming(this.currentHours)}},o.prototype.hourClicked=function(t){var e=t.target,i=this.parent.element.querySelector(".item-hour.selected");i&&i.classList.remove("selected"),e.classList.add("selected"),this.parent.hour=parseInt(e.dataset.val,10),this.parent.switchToMinutes()},o}(h);e.HoursPanel=c;var m=function(t){function e(e){t.call(this,e),this.element.classList.add("minutespanel");var i=o;this.parent.radial&&(i=a);var n=this.renderItems(i,"min",this.parent.minutes,this.minuteClicked.bind(this));this.content.appendChild(n)}return __extends(e,t),e.prototype.minuteClicked=function(t){var e=t.target,i=this.parent.element.querySelector(".item-min.selected");i&&i.classList.remove("selected"),e.classList.add("selected");var n=parseInt(e.dataset.val,10);this.parent.minutes=n},e.prototype.setFocus=function(){var t=this.content.querySelector(".item-min.selected");t||(t=t=this.content.querySelector(".item-min")),t&&t.focus()},e}(h);e.MinutesPanel=m}(e=t.UI||(t.UI={}))}(WinJSContrib||(WinJSContrib={}));