/* 
 * WinJS Contrib v2.0.1.0
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";WinJS.Namespace.define("WinJSContrib.UI",{GridControl:WinJS.Class.define(function(e,t){var l=this;if(t=t||{},l.element=e,l.$element=$(l.element),l.element.className=l.element.className+" mcn-grid-ctrl mcn-layout-ctrl win-disposable",l.element.winControl=l,l.autolayout=t.autolayout,l.autolayout){var i=WinJSContrib.Utils.getScopeControl(l.element);i&&i.elementReady&&i.elementReady.then(function(){return i.beforeShow||(i.beforeShow=[]),i.beforeShow.push(function(){l.layout()}),i.renderComplete})}l.renderer=new WinJSContrib.UI.MultiPassRenderer(l.element,{multipass:t.multipass,itemClassName:t.itemClassName,itemTemplate:t.itemTemplate,itemInvoked:t.itemInvoked}),l.gridLayouts=t.layouts,l.defaultLayout={layout:"horizontal",itemsPerColumn:t.itemsPerColumn?t.itemsPerColumn:void 0,itemsPerRow:t.itemsPerRow?t.itemsPerRow:void 0,cellSpace:t.cellSpace?t.cellSpace:10,cellWidth:t.cellWidth?t.cellWidth:void 0,cellHeight:t.cellHeight?t.cellHeight:void 0}},{scrollContainer:{get:function(){return this.renderer.scrollContainer},set:function(e){this.renderer.scrollContainer=e}},itemInvoked:{get:function(){return this.renderer.itemInvoked},set:function(e){this.renderer.itemInvoked=e}},itemTemplate:{get:function(){return this.renderer.itemTemplate},set:function(e){this.renderer.itemTemplate=e}},itemClassName:{get:function(){return this.renderer.itemClassName},set:function(e){this.renderer.itemClassName=e}},prepareItems:function(e,t){var l=WinJSContrib.Utils.getParentControlByClass("mcn-layout-ctrl",this.element);!this.renderer.multipass&&l&&l.multipass&&(this.renderer.multipass=l.multipass),this.renderer.prepareItems(e,t)},pageLayout:function(){this.renderer.pageLayout(),this.autolayout&&this.layout()},renderItemsContent:function(){this.renderer.renderItemsContent()},clear:function(){var e=this;e.$element.css("position","").css("display","").css("width","").css("height","").css("min-width","").css("min-height",""),e.$element.children().each(function(){$(this).css("position","").css("left","").css("top","").css("width","").css("height","")})},fill:function(e,t,l,i,n){if(e.length<t+i)for(var a=e.length;t+i>a;a++)e.push([]);for(var a=t;t+i>a;a++){var r=e[a];if(r.length<l+n)for(var o=r.length;l+n>o;o++)r.push(!1);for(var o=l;l+n>o;o++)r[o]=!0}},fit:function(e,t,l,i,n,a,r){if(r&&n>r&&0===l)return!0;if(a&&i>a&&0===t)return!0;if(a&&t+i>a)return!1;if(r&&l+n>r)return!1;for(var o=t;t+i>o;o++){var s=e[o];if(s)for(var d=l;l+n>d;d++)if(s[d]===!0)return!1}return!0},firstFit:function(e,t,l,i,n){for(var a=this,r=0;n*i*2>r;r++){var o=e[r];if(!o)return{x:r,y:0};for(var s=0;i>s;s++)if(o[s]!==!0&&a.fit(e,r,s,t,l,void 0,i))return{x:r,y:s}}return void 0},visibleChilds:function(){for(var e=this,t=[],l=e.$element.children(),i=0;i<l.length;i++){var n=l[i],a=window.getComputedStyle(n);"none"!=a.display&&"hidden"!=a.visibility&&t.push(n)}return t},GridLayoutsImpl:{none:function(){},flexhorizontal:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.display="flex",e.element.style.flexFlow="column wrap",e.element.style.alignContent="flex-start",e.element.style.width&&(e.element.style.width=""),e.element.style.height="",e.element.style.height=e.element.clientHeight?e.element.clientHeight+"px":"";var t=Math.floor(e.element.clientHeight/(e.data.cellHeight+e.data.cellSpace));if(t){var l=e.visibleChilds(),i=Math.ceil(l.length/t);e.element.style.minWidth=(e.data.cellWidth+e.data.cellSpace)*i+"px"}},flexvertical:function(){var e=this;e.renderer.orientation="vertical",e.element.style.position="relative",e.element.style.display="flex",e.element.style.flexFlow="row wrap",e.element.style.alignContent="flex-start",e.element.style.width="",e.element.style.width=e.element.clientWidth?e.element.clientWidth+"px":"",e.element.style.height&&(e.element.style.height="")},hbloc:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.height="";var t=e.element.clientHeight;if(t){var l=e.data.cellWidth,i=e.data.cellSpace,n=1,a=0,r=0,o=e.$element.children();o.each(function(){var e=this;if("none"!=e.style.display){"absolute"!=e.style.position&&(e.style.position="absolute");var o=e.clientHeight;r+o>t&&(n++,a=a+i+l,r=0),e.style.left!=a+"px"&&(e.style.left=a+"px"),e.style.top!=r+"px"&&(e.style.top=r+"px"),r+=o}}),a+=l,e.element.style.width!=a+"px"&&(e.element.style.width=a+"px")}},horizontal:function(){var e=this;e.renderer.orientation="horizontal",e.element.style.position="relative",e.element.style.height="";var t=e.element.clientHeight;if(t){var l=Math.floor(t/(e.data.cellHeight+e.data.cellSpace));0>=l&&(l=1);var i=e.data.cellWidth,n=e.data.cellHeight,a=e.data.cellSpace,r=1,o=1;e.data.itemsPerColumn&&(l=e.data.itemsPerColumn,n=(t-(l-1)*a)/l>>0,i=e.data.cellWidth*n/e.data.cellHeight>>0,r=i/e.data.cellWidth,o=n/e.data.cellHeight);var s=[[]],d=e.$element.children();d.each(function(){var t=this,d=window.getComputedStyle(t);if("none"!=d.display){t.style.position="absolute";var h=$(this),c=h.outerWidth()*r,u=h.outerHeight()*o,m=c/i>>0,y=u/n>>0,f=e.firstFit(s,m,y,l,e.element.children.length);f||(f={x:0,y:0}),e.fill(s,f.x,f.y,m,y);var p=f.x*(i+a),v=f.y*(n+a),g=m*i+(m-1)*a,w=y*n+(y-1)*a;t.style.left=p+"px",t.style.top=v+"px",t.style.width=g+"px",t.style.height=w+"px"}});var h=s.length*(i+a);e.element.style.width=h+"px"}},vertical:function(){var e=this;e.renderer.orientation="vertical",e.element.style.width="",e.element.style.position="relative";var t=e.element.clientWidth;if(t){var l=Math.floor(t/(e.data.cellWidth+e.data.cellSpace));0>=l&&(l=1);var i=e.data.cellWidth,n=e.data.cellHeight,a=e.data.cellSpace,r=1,o=1;e.data.itemsPerRow&&(l=e.data.itemsPerRow,i=(t-(l-1)*a)/l>>0,n=e.data.cellHeight*i/e.data.cellWidth>>0,r=i/e.data.cellWidth,o=n/e.data.cellHeight);var s=[[]];e.$element.children().each(function(){var t=this,d=window.getComputedStyle(t);if("none"!=d.display){t.style.position="absolute";var h=$(this),c=h.outerWidth()*r,u=h.outerHeight()*o,m=c/i>>0,y=u/n>>0,f=e.firstFit(s,y,m,l,e.element.children.length);e.fill(s,f.x,f.y,y,m);var p=f.y*(i+a),v=f.x*(n+a);t.style.left=p+"px",t.style.top=v+"px",t.style.width=m*i+(m-1)*a+"px",t.style.height=y*n+(y-1)*a+"px"}});var d=s.length*(n+a);e.element.style.height=d+"px"}}},layout:function(){var e=this,t=e.data;if(e.data=e.getLayout(),e.data){if(e.data.cellSpace=void 0!=e.data.cellSpace?e.data.cellSpace:void 0!=e.defaultLayout.cellSpace?e.defaultLayout.cellSpace:10,e.data.cellWidth=e.data.cellWidth||e.defaultLayout.cellWidth||0,e.data.cellHeight=e.data.cellHeight||e.defaultLayout.cellHeight||0,(!e.data.cellWidth||!e.data.cellHeight)&&e.element.childNodes&&e.element.children.length>0){var l=e.element.children[e.element.children.length-1],i=$(l);e.data.cellWidth=i.outerWidth(),e.data.cellHeight=i.outerHeight()}var n=!t||e.data.layout!==t.layout,a=e.GridLayoutsImpl[e.data.layout.toLowerCase()];a&&(n&&e.changeLayout(),a.bind(e)(n),e.data.applyed=!0),e.renderer.checkRendering()}},changeLayout:function(){var e=this;e.clear(),e.renderer.updateLayout()},updateLayout:function(){var e=this;e.layout()},getLayout:function(){var e=this,t=void 0;if(e.gridLayouts)for(var l in e.gridLayouts){var i=e.gridLayouts[l];if(e.gridLayouts.hasOwnProperty(l))if(i.query){var n=window.matchMedia(i.query);n.matches&&(t=i)}else t||(t=i);else t||(t=i)}return t||(t=e.defaultLayout),JSON.parse(JSON.stringify(t))},dispose:function(){WinJS.Utilities.disposeSubTree&&WinJS.Utilities.disposeSubTree(this.element)}})})}();