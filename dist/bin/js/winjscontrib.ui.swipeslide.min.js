/* 
 * WinJS Contrib v2.1.0.4
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){"use strict";function e(e){}WinJS.Namespace.define("WinJSContrib.UI",{SwipeSlide:WinJS.Class.mix(WinJS.Class.define(function(e,t){this.element=e||document.createElement("DIV"),t=t||{},this.moveDivider=t.moveDivider||1,this.threshold=t.threshold||40,this.touchOnly=!1,this.minSwipeDistance=t.minSwipeDistance||100,this.direction=t.direction||"horizontal",this.element.winControl||(this.element.winControl=this),this.element.classList.add("mcn-swipeslide"),this.element.classList.add("win-disposable"),this.target=this.element,this.eventTracker=new WinJSContrib.UI.EventTracker,this.ptDown=null,this.registerEvents(),this.allowed=t.allowed||{left:!0,right:!0},this.disabled=!1,WinJS.UI.setOptions(this,t),this.thresholdFactor=this.thresholdFactor||4},{registerEvents:function(){void 0!==this.element.onpointerdown?(this.eventTracker.addEvent(this.element,"pointerdown",this._processDown.bind(this),!0),this.eventTracker.addEvent(this.element,"pointerup",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"pointercancel",this._processCancel.bind(this),!0),this.eventTracker.addEvent(this.element,"pointermove",this._processMove.bind(this),!0)):window.Touch?(this.eventTracker.addEvent(this.element,"touchstart",this._processDown.bind(this),!0),this.eventTracker.addEvent(this.element,"touchend",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"touchcancel",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"touchmove",this._processMove.bind(this),!0)):(this.eventTracker.addEvent(this.element,"mousedown",this._processDown.bind(this),!0),this.eventTracker.addEvent(this.element,"mouseup",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"mouseleave",this._processUp.bind(this),!0),this.eventTracker.addEvent(this.element,"mousemove",this._processMove.bind(this),!0))},_initPtDown:function(e){var t=0,i=0;if(e.changedTouches){if(window.WebKitCSSMatrix){var n=new window.WebKitCSSMatrix(this.target.style.transform||this.target.style.webkitTransform||"");t=n.m41,i=n.m42}this.ptDown={x:e.changedTouches[0].screenX,y:e.changedTouches[0].screenY,confirmed:!1,transformOffsetX:t,transformOffsetY:i}}else{if(window.MSCSSMatrix){var n=new window.MSCSSMatrix(this.target.style.transform);t=n.m41,i=n.m42}this.ptDown={x:e.screenX,y:e.screenY,confirmed:!1,transformOffsetX:t,transformOffsetY:i,maxDX:0,maxDY:0}}},_processDown:function(e){this.disabled||(this.capturePointerOnDown&&(e.preventDefault(),e.stopPropagation()),this._initPtDown(e),this.capturePointerOnDown&&e.pointerId&&this.element.setPointerCapture&&this.element.setPointerCapture(e.pointerId))},_processLeave:function(e){{var t=this;e.currentTarget||e.target}console.log("pointer leave"),t._processUp(e)},_processCancel:function(e){{var t=this;e.currentTarget||e.target}console.log("pointer cancel");e.currentTarget||e.target;if(e.pointerId&&t.element.releasePointerCapture)try{t.element.releasePointerCapture(e.pointerId)}catch(i){}t._cancelMove(),t.ptDown=null,t.dispatchEvent("swipeend")},_processUp:function(t){{var i=this;t.currentTarget||t.target}if(t.pointerId&&i.element.releasePointerCapture)try{i.element.releasePointerCapture(t.pointerId)}catch(n){}if(i.ptDown){if(t.changedTouches)var s=i.ptDown.x-t.changedTouches[0].screenX,o=i.ptDown.y-t.changedTouches[0].screenY;else var s=i.ptDown.x-t.screenX,o=i.ptDown.y-t.screenY;var r=this.ptDown.transformOffsetX+(-s-this.threshold)/(window.devicePixelRatio*this.moveDivider),a=!0;if(t.pointerId&&this.touchOnly&&"touch"!=t.pointerType&&(a=!1),a&&i._acceptSwipe(r)){this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent);var h={dX:s,dY:o,move:-s-i.threshold,screenMove:i.ptDown.screenMove,direction:s>0?"left":"right",handled:!1};"left"==h.direction&&i.allowed.left||"right"==h.direction&&i.allowed.right?(i.dispatchEvent("swipe",h),e("swipe slide, swipeHandled "+i.swipeHandled+"/"+h.handled+"/"+i.zurgl),i.swipeHandled||i._cancelMove()):i._cancelMove()}else this.ptDown.maxDX<i.threshold&&this.ptDown.maxDY<i.threshold?(i.dispatchEvent("invoked",h),i.swipeHandled||i._cancelMove()):i._cancelMove()}else i._cancelMove();i.ptDown=null,i.dispatchEvent("swipeend")},_acceptSwipe:function(e){var t=this,i=Math.abs(e);return i<t.minSwipeDistance?!1:i>t.element.clientWidth/t.thresholdFactor},_toSize:function(e){return 0!==e?e+"px":"0px"},_cancelMove:function(){var t=this,i=this.target,n=0,s=0;this.ptDown&&(n=this.ptDown.transformOffsetX,s=this.ptDown.transformOffsetY),this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent),e("swipe slide, cancel move "+n+"/"+s),i&&(i.style.transition="transform 120ms ease-out",i.style.hasOwnProperty("webkitTransition")&&(i.style.webkitTransition="transform 90ms ease-out"),setImmediate(function(){i.style.transform="translate3d("+t._toSize(n)+", "+t._toSize(s)+", 0px)",i.style.hasOwnProperty("webkitTransform")&&(i.style.webkitTransform="translate3d("+t._toSize(n)+", "+t._toSize(s)+", 0px)"),setTimeout(function(){i.style.transition="",i.style.hasOwnProperty("webkitTransition")&&(i.style.webkitTransition="")},100)}))},_processMove:function(t){var i=this;if(!this.disabled)if(!this.ptDown&&t.changedTouches&&this._initPtDown(t),this.ptDown){var n=!0;if(t.pointerId&&this.touchOnly&&"touch"!=t.pointerType&&(n=!1),!n)return;if(t.changedTouches)var s=this.ptDown.x-t.changedTouches[0].screenX,o=this.ptDown.y-t.changedTouches[0].screenY;else var s=this.ptDown.x-t.screenX,o=this.ptDown.y-t.screenY;var r=Math.abs(s),a=Math.abs(o);if(this.ptDown.maxDX=Math.max(this.ptDown.maxDX,r),this.ptDown.maxDY=Math.max(this.ptDown.maxDY,a),r>5&&r>a&&(t.preventDefault(),t.stopPropagation()),!this.ptDown.confirmed){if(a>this.threshold)return void(this.ptDown=null);if(r>this.threshold){var h=this.ptDown.transformOffsetX+(-s-this.threshold)/(window.devicePixelRatio*this.moveDivider);this.ptDown.confirmed=!0,this.swipeHandled=!1,e("start swipe");var c={dX:s,dY:o,move:-s-i.threshold,screenMove:i.ptDown.screenMove,direction:s>0?"left":"right",handled:!1};this.dispatchEvent("swipestart",c);{t.currentTarget||t.target}t.pointerId&&this.element.setPointerCapture&&this.element.setPointerCapture(t.pointerId)}}if(this.ptDown.confirmed){var h=this.ptDown.transformOffsetX+(-s-this.threshold)/(window.devicePixelRatio*this.moveDivider);e("swipe move "+s+" / "+h);var d=this.setMove(h,-s);this.dispatchEvent("swipeprogress",{screenMove:d,move:-s-this.threshold,direction:s>0?"left":"right",accept:i._acceptSwipe(h),dX:s,dY:o})}}else e("swipe move")},setMove:function(t,i){var n=this;return i>0&&!this.allowed.right?(t=Math.sqrt(t),t>this.element.clientWidth/6&&(t=this.element.clientWidth/6)):0>i&&!this.allowed.left&&(t=-Math.sqrt(-t),t<-(this.element.clientWidth/6)&&(t=-(this.element.clientWidth/6))),this.minMoveBounds&&t<this.minMoveBounds&&(t=this.minMoveBounds),this.maxMoveBounds&&t>this.maxMoveBounds&&(t=this.maxMoveBounds),this.setMoveIntent&&cancelAnimationFrame(this.setMoveIntent),n.ptDown&&(n.ptDown.screenMove=t),this.setMoveIntent=requestAnimationFrame(function(){this.setMoveIntent=null,e("transform to "+t),void 0!==n.target.style.webkitTransform?n.target.style.webkitTransform="translate3d("+n._toSize(t)+", 0px, 0px)":n.target.style.transform="translate3d("+n._toSize(t)+", 0px, 0px)"}),t},dispose:function(){this.eventTracker.dispose();try{WinJS.Utilities.disposeSubTree(this.element)}catch(e){}}}),WinJS.UI.DOMEventMixin,WinJS.Utilities.createEventProperties("swipe","swipeprogress","swipestart"))})}();