/* 
 * WinJS Contrib v2.1.0.6
 * licensed under MIT license (see http://opensource.org/licenses/MIT)
 * sources available at https://github.com/gleborgne/winjscontrib
 */

!function(){var e=WinJSContrib.Logs.getLogger("WinJSContrib.UI.ChildViewFlyout");WinJS.Namespace.define("WinJSContrib.UI",{parentChildView:function(e){for(var i=e.parentNode;i;){if(i.mcnChildnav)return i.winControl;i=i.parentNode}},ChildViewFlyout:WinJS.Class.mix(WinJS.Class.define(function(e,i){e.winControl=this,i=i||{},this.element=e||document.createElement("div"),i.inplace?this.rootElement=this.element:(this.rootElement=document.createElement("div"),this.rootElement.mcnChildnav=!0,this.rootElement.winControl=this,this.element.style.display="none"),document.body.appendChild(this.rootElement),this.navigationEvents=i.navigationEvents,this.element.mcnChildnav=!0,this.element.classList.add("mcn-childview"),this.element.classList.add("win-disposable"),this.rootElement.classList.add("childNavigator"),this.rootElement.classList.add("hidden"),this.element.classList.add("mcn-navigation-ctrl"),this.target=i.target||null,this._createContent(i),this.hardwareBackBtnPressedBinded=this.hardwareBackBtnPressed.bind(this),this.childContentKeyUp=this._childContentKeyUp.bind(this)},{_createContent:function(e){{var i=this,n=WinJSContrib.UI.FluentDOM;new n("DIV")}i.overlay=new n("DIV").addClass("childNavigator-overlay").appendTo(i.rootElement).tap(function(){i.hide()},{disableAnimation:!0,disableAria:!0}).element,i.contentPlaceholder=new n("DIV","childNavigator-contentPlaceholder",i.rootElement).append("DIV",null,function(e){i.navigator=new WinJSContrib.UI.PageControlNavigator(e.element,{global:!1}),i.navigator.animations.enterPage=WinJS.UI.Animation.fadeIn,i.navigator.hide=function(e){return i.hide(e)}}).element,e&&e.closeBtn&&e.closeBtn.active&&(i.closebtn=new n("DIV","mcn-close-btn",i.contentPlaceholder),e.closeBtn.templatetext&&i.closebtn.html(e.closeBtn.templatetext),e.closeBtn["class"]?i.closebtn.className(i.closebtn.element.className+" "+e.closeBtn["class"]):e.closeBtn.templatetext||i.closebtn.className(i.closebtn.element.className+" default-icon"),WinJSContrib.UI.tap(i.closebtn.element,function(){i.closePage()}))},navigate:function(e,i,n){var t=this;return t.navigator.navigate(e,i)},pageControl:{get:function(){return this.container&&this.container.winControl}},isOpened:{get:function(){return this.contentPlaceholder.classList.contains("enter")||this.contentPlaceholder.classList.contains("enter-active")}},clear:function(i){var n=this;return e.verbose("clear"),new WinJS.Promise(function(e,t){WinJS.Promise.wrap(n.closePage(null,null,i)).done(function(){n.navigator.clear(),n.navigator.element.innerText="",n.location=void 0,e()})})},closePage:function(i,n,t){var o=this,s=n?n.winControl:null;e.verbose("close page "+(s?s.uri:""));var a=t?WinJS.Promise.wrap(!0):o.canClose(s),r=a.then(function(e){if(!e)return WinJS.Promise.wrapError();o.navigator.pagesCount;return o.navigator.triggerPageExit(),o.navigator.closePage(n).then(function(){return 0==o.navigator.pagesCount?o.hide(i,null,!0):void(WinJSContrib.UI.Application.progress&&WinJSContrib.UI.Application.progress.hide())})});return o.closePagePromise=o.closePagePromise?o.closePagePromise.then(function(){return r},function(){}).then(function(){return t?WinJS.Promise.wrap(!0):o.canClose(s)}):r,r},back:function(e){var i=this;return i.navigator.back(e)},canGoBack:function(){return that.navigator.canGoBack},_childContentKeyUp:function(e){"Esc"===e.key&&this.hide()},hardwareBackBtnPressed:function(e){var i=this;i.navigator._checkBackNavigation(e)||(i.hide(),e.handled=!0)},show:function(i){var n=this;return e.verbose("show"),n.target&&n.target.classList.add("childview-target"),n.isOpened?WinJS.Promise.wrap():(e.verbose("show exec"),WinJSContrib.UI&&WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),systemNavigationManager.appViewBackButtonVisibility===window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed&&(systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.visible)),document.body.addEventListener("keyup",n.childContentKeyUp),this.addDismissableClass("visible"),this.addDismissableClass("enter"),this.removeDismissableClass("leave"),this.removeDismissableClass("hidden"),n.rootElement.getBoundingClientRect(),n.navEventsHandler=WinJSContrib.UI.registerNavigationEvents(n,this.hardwareBackBtnPressedBinded),n.navigationEvents&&n.navigator.addNavigationEvents(),n.showChildViewPromise=WinJS.Promise.timeout().then(function(){return n.hideChildViewPromise}).then(function(){return n.hideChildViewPromise=null,n.addDismissableClass("enter-active"),n.addDismissableClass("visible"),n.addDismissableClass("enter"),n.removeDismissableClass("leave"),n.removeDismissableClass("hidden"),WinJSContrib.UI.afterTransition(n.contentPlaceholder).then(function(){n.contentPlaceholder.classList.contains("enter")})}),n.showChildViewPromise)},addDismissableClass:function(e){var i=this;i.overlay.classList.add(e),i.contentPlaceholder.classList.add(e),i.rootElement.classList.add(e),i.target&&i.target.classList.add("childview-"+e)},removeDismissableClass:function(e){var i=this;i.overlay.classList.remove(e),i.overlay.classList.remove(e+"-active"),i.contentPlaceholder.classList.remove(e),i.contentPlaceholder.classList.remove(e+"-active"),i.rootElement.classList.remove(e),i.rootElement.classList.remove(e+"-active"),i.target&&(i.target.classList.remove("childview-"+e),i.target.classList.remove("childview-"+e+"-active"))},pick:function(e,i,n){var t=this;i=i||{},t.pickPromises=t.pickPromises||[];var o=new WinJS.Promise(function(o,a){var r=!1,l=null,c=function(e,i,n){s();try{l&&l.element&&l.removeEventListener&&l.removeEventListener("closing",c),t.removeEventListener("beforehide",c)}catch(a){console.error(a)}r||(r=!0,o({completed:i,data:n}))};i.navigateStacked=!0,i.injectToPage={close:function(e){s(),c(null,!0,e);try{l&&l.element&&l.removeEventListener&&l.removeEventListener("closing",c),t.removeEventListener("beforehide",c)}catch(i){console.error(i)}t.closePage(e,this.element||this.rootElement)},cancel:function(){c(null,!1),t.closePage()}},t.open(e,i,n).then(function(e){l=t.navigator.pageControl,l&&l.element&&l.addEventListener("closing",c),t.addEventListener("beforehide",c,!1)})}),s=function(){var e=t.pickPromises.indexOf(o);t.pickPromises.splice(e,1)};return t.pickPromises.push(o),o.then(s,s),o},open:function(i,n,t){var o=this;return o.rootElement.classList.add("visible"),o.dispatchEvent("beforeshow"),e.verbose("open "+i),o.openChildViewPromise=new WinJS.Promise(function(s,a){WinJS.Promise.as(o.hideChildViewPromise).then(function(){var s=WinJS.Promise.wrap();return o.isOpened||(e.verbose("open and show"),s=o.show(!0)),WinJS.Promise.join({show:WinJSContrib.UI.afterTransition(o.contentPlaceholder),navigate:o.navigate(i,n,t).done(function(e){o.dispatchEvent("aftershow")})})}).then(s,a)}),o.openChildViewPromise},canClose:function(e){return e=e||this.navigator.pageControl,e&&e.canClose?WinJS.Promise.as(e.canClose()).then(function(e){return e}):WinJS.Promise.wrap(!0)},hide:function(i,n,t){var o=this;if(e.verbose("hide"),o.isOpened){o.showChildViewPromise=null,o.closePagePromise=null,o.openChildViewPromise=null;var s=t?WinJS.Promise.wrap(!0):o.canClose(),a=o.navigator.element.children,r=o.hideChildViewPromise;return o.hideChildViewPromise=s.then(function(e){return WinJS.Promise.as(r).then(function(){return e})}).then(function(n){return n?o.isOpened?(e.verbose("hide exec"),o.addDismissableClass("leave"),o.removeDismissableClass("enter"),o.pickPromises&&o.pickPromises.forEach(function(e){e.cancel()}),document.body.removeEventListener("keyup",o.childContentKeyUp),o.dispatchEvent("beforehide",i),o.navigator.canGoBack||WinJS.Navigation.canGoBack||WinJSContrib.UI&&WinJSContrib.UI.enableSystemBackButtonVisibility&&window.Windows&&window.Windows.UI&&window.Windows.UI.Core&&window.Windows.UI.Core.SystemNavigationManager&&(systemNavigationManager=window.Windows.UI.Core.SystemNavigationManager.getForCurrentView(),systemNavigationManager.appViewBackButtonVisibility===window.Windows.UI.Core.AppViewBackButtonVisibility.visible&&(systemNavigationManager.appViewBackButtonVisibility=window.Windows.UI.Core.AppViewBackButtonVisibility.collapsed)),o.navEventsHandler&&(o.navEventsHandler(),o.navigator.removeNavigationEvents(),o.navEventsHandler=null),WinJS.Promise.timeout().then(function(){return o.addDismissableClass("leave-active"),WinJS.Promise.join({overlay:WinJSContrib.UI.afterTransition(o.overlay,1e3),content:WinJSContrib.UI.afterTransition(o.contentPlaceholder,1e3)}).then(function(){if(o.contentPlaceholder.classList.contains("leave")&&(o.clear(!0),o.removeDismissableClass("visible"),o.addDismissableClass("hidden"),o.removeDismissableClass("leave"),o.dispatchEvent("afterhide",i)),a&&a.length)for(var e=0;e<a.length;e++){var n=a[e];o.closePage(null,n)}})})):void 0:!1}),o.hideChildViewPromise}return WinJS.Promise.wrap(!0)},dispose:function(){this.rootElement.winControl=null,WinJS.Utilities.disposeSubTree(this.rootElement),WinJS.Utilities.disposeSubTree(this.element),this.rootElement.parentElement.removeChild(this.rootElement)}}),WinJS.Utilities.eventMixin,WinJS.Utilities.createEventProperties("beforeshow","beforehide","aftershow","afterhide"))})}();