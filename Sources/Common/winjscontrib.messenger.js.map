{"version":3,"sources":["Sources/Common/winjscontrib.messenger.ts"],"names":["WinJSContrib","WinJSContrib.MessengerClass","WinJSContrib.MessengerClass.constructor","WinJSContrib.MessengerClass._send","WinJSContrib.MessengerClass.importScripts","WinJSContrib.MessengerClass._doImportScripts","WinJSContrib.MessengerClass.execute","WinJSContrib.MessengerClass._runFunction","WinJSContrib.MessengerClass.map","WinJSContrib.MessengerClass.start","WinJSContrib.MessengerClass.start.oncancel","WinJSContrib.MessengerClass._processEvent","WinJSContrib.MessengerClass.dispose"],"mappings":"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","file":"Sources/Common/winjscontrib.messenger.js","sourcesContent":["var __global = this;\r\n\r\nmodule WinJSContrib {\r\n    declare var messengerFunction: Function;\r\n\r\n    export class MessengerClass {\r\n        /**\r\n         * default path for smart worker js file\r\n         */\r\n        static SmartWorkerPath = '/scripts/winjscontrib/winjscontrib.messenger.worker.js';\r\n        public isWorker: boolean;\r\n        _pendings: any;\r\n        _receiver: any;\r\n        _sender: any;\r\n        _bindedProcessEvent: any;\r\n        public messengerId : string;\r\n        public domain: string;\r\n        dispatchEvent: (eventname: string, obj?: any) => void;\r\n        addEventListener: (eventname : string, callback : Function) => void;\r\n\r\n        constructor(receiver, sender) {\r\n            var messenger = this;\r\n            messenger.isWorker = receiver.document === undefined;\r\n            messenger._pendings = {};\r\n            messenger._receiver = receiver;\r\n            messenger._sender = sender || receiver;\r\n            messenger._bindedProcessEvent = messenger._processEvent.bind(messenger);\r\n\r\n            if (messenger._receiver)\r\n                messenger._receiver.addEventListener('message', messenger._bindedProcessEvent);\r\n        }\r\n\r\n        private _send(obj) {\r\n            if (this.isWorker) {\r\n                this._sender.postMessage(JSON.stringify(obj));\r\n            }\r\n            else {\r\n                this._sender.postMessage(JSON.stringify(obj), this.domain || '*');\r\n            }\r\n        };\r\n\r\n        /**\r\n         * import script files\r\n         * @param {Array} scriptPaths an array of string paths to js files\r\n         */\r\n        importScripts(scriptPaths:string[]) {\r\n            if (!this._receiver)\r\n                return WinJS.Promise.wrap();\r\n\r\n            return this.start('_doImportScripts', scriptPaths);\r\n        }\r\n\r\n        private _doImportScripts(scriptPaths) {\r\n            return new WinJS.Promise(function(c) {\r\n                if (typeof scriptPaths == 'string') {\r\n                    importScripts(scriptPaths);\r\n                } else if (scriptPaths.length) {\r\n                    for (var i = 0; i < scriptPaths.length; i++) {\r\n                        importScripts(scriptPaths[i]);\r\n                    }\r\n                }\r\n                c();\r\n            });\r\n        }\r\n\r\n        /**\r\n         * run the callback in the web worker. The callback is serialized to string so you must pass all variable used inside the function as arguments\r\n         * @param {function} func function callback\r\n         * @param {...Object} args\r\n         * @returns {WinJS.Promise}\r\n         */\r\n        execute(func) {\r\n            var messenger = this;\r\n            var args = [];\r\n            if (arguments.length > 1) {\r\n                for (var i = 1; i < arguments.length; i++) {\r\n                    args.push(arguments[i]);\r\n                }\r\n            }\r\n\r\n            if (messenger._receiver) {\r\n                var f = 'var messengerFunction=' + func;\r\n\r\n                return this.start('_runFunction', { f: f, args: args });\r\n            }\r\n            else {\r\n                return WinJS.Promise.timeout(0).then(function() {\r\n                    return func.apply(null, args);\r\n                });\r\n            }\r\n        }\r\n\r\n        private _runFunction(functionArgs) {\r\n            var messenger = this;\r\n            return new WinJS.Promise(function(c, e) {\r\n                try {\r\n                    eval(functionArgs.f);\r\n\r\n                    var res = messengerFunction.apply(null, functionArgs.args);\r\n                    c(res);\r\n                } catch (exception) {\r\n                    e(exception);\r\n                }\r\n            });\r\n        }\r\n\r\n        map(object, functions) {\r\n            var messenger = this;\r\n            functions.forEach(function(name) {\r\n                messenger[name] = function() {\r\n                    var f = object[name];\r\n                    return f.apply(object, arguments);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * start an operation within iframe or worker and get a promise for completion\r\n         * @param {string} eventName name of the event/function to call\r\n         * @param {Object} data event/function passed as argument\r\n         * @returns {WinJS.Promise}\r\n         */\r\n        start(eventName, data?, asArgs?) {\r\n            var messenger = this;\r\n\r\n            if (!messenger._receiver)\r\n                return WinJS.Promise.wrapError('worker not supported');\r\n\r\n            var wrapper = {\r\n                id: WinJSContrib.Utils.guid(),\r\n                complete: null, error: null, progress: null, promise: null\r\n            }\r\n\r\n            var event = {\r\n                name: eventName,\r\n                id: wrapper.id,\r\n                messengerId: messenger.messengerId,\r\n                type: 'run',\r\n                data: data,\r\n                asArgs: asArgs,\r\n                sender: 'WinJSContrib.WinJSContrib.Messenger'\r\n            };\r\n\r\n            wrapper.promise = new WinJS.Promise(function(c, e, p) {\r\n                wrapper.complete = c;\r\n                wrapper.error = e;\r\n                wrapper.progress = p;\r\n            }, function oncancel() {\r\n                console.warn('message canceled');\r\n                event.type = 'cancel';\r\n                messenger._send(event);\r\n            });\r\n\r\n            messenger._pendings[wrapper.id] = wrapper;\r\n            var cleanUp = function() {\r\n                delete messenger._pendings[wrapper.id];\r\n            }\r\n            wrapper.promise.done(cleanUp, cleanUp);\r\n            messenger._send(event);\r\n\r\n            return wrapper.promise;\r\n        };\r\n\r\n        private _processEvent(arg) {\r\n            var messenger = this;\r\n\r\n            var details = typeof (arg.data) == 'string' ? JSON.parse(arg.data) : arg.data;\r\n            var name = details.name;\r\n            var data = details.data;\r\n            var asArgs = details.asArgs;\r\n\r\n            if (details.messengerId != messenger.messengerId)\r\n                return;\r\n\r\n            if (details.id) {\r\n                var wrapper = messenger._pendings[details.id];\r\n                if (wrapper && wrapper[details.type]) {\r\n                    wrapper[details.type](data);\r\n                    return;\r\n                }\r\n\r\n                if (details.type === 'cancel') {\r\n                    var current = messenger._pendings[details.id];\r\n                    if (current) {\r\n                        current.promise.cancel();\r\n                        delete messenger._pendings[details.id];\r\n                    }\r\n                }\r\n                else if (details.type === 'run' && name && messenger[name]) {\r\n                    try {\r\n                        var p = null;\r\n                        if (asArgs) {\r\n                            p = WinJS.Promise.as(messenger[name].apply(messenger[name], data));\r\n                        } else {\r\n                            p = WinJS.Promise.as(messenger[name](data));\r\n                        }\r\n\r\n                        messenger._pendings[details.id] = { promise: p, details: details };\r\n\r\n                        p.then(function(arg) {\r\n                            messenger._send({ name: name, id: details.id, messengerId: messenger.messengerId, type: 'complete', sender: 'WinJSContrib.WinJSContrib.Messenger', data: arg });\r\n                        }, function(arg) {\r\n                            messenger._send({ name: name, id: details.id, messengerId: messenger.messengerId, type: 'error', sender: 'WinJSContrib.WinJSContrib.Messenger', data: arg });\r\n                        }, function(arg) {\r\n                            messenger._send({ name: name, id: details.id, messengerId: messenger.messengerId, type: 'progress', sender: 'WinJSContrib.WinJSContrib.Messenger', data: arg });\r\n                        }).then(function() {\r\n                            delete messenger._pendings[details.id];\r\n                        });\r\n                    } catch (exception) {\r\n                        delete messenger._pendings[details.id];\r\n                        messenger._send({ name: name, id: details.id, messengerId: messenger.messengerId, type: 'error', sender: 'WinJSContrib.WinJSContrib.Messenger', data: { description: exception.description, message: exception.message, stack: exception.stack } });\r\n                    }\r\n\r\n                    return;\r\n                }\r\n                else if (details.type === 'run') {\r\n                    messenger._send({ name: name, id: details.id, messengerId: messenger.messengerId, type: 'error', sender: 'WinJSContrib.WinJSContrib.Messenger', data: { message: 'callback function not found' } });\r\n                }\r\n            } else {\r\n                if (name && messenger[name]) {\r\n                    messenger[name](data);\r\n                    return;\r\n                }\r\n                messenger.dispatchEvent(name, data);\r\n            }\r\n        };\r\n\r\n        /**\r\n         * release messenger and associated resources (if using webworker, worker is terminated\r\n         */\r\n        dispose() {\r\n            var messenger = this;\r\n            if (messenger._receiver) {\r\n                if (messenger._receiver.terminate)\r\n                    messenger._receiver.terminate();\r\n\r\n                messenger._receiver.removeEventListener('message', messenger._bindedProcessEvent);\r\n            }\r\n        };\r\n    }\r\n\r\n    /**\r\n     * @classdesc\r\n     * Wrapper for messaging between main code and iframe or web worker. All returns are wrapped as WinJS.Promise to enable asynchronous scenarios     \r\n     * @class\r\n     * @param {DOMElement} receiver element that will receive messages\r\n     * @param {DOMElement} sender element that will send messages\r\n     */\r\n    export var Messenger: typeof MessengerClass = WinJS.Class.mix(MessengerClass, WinJS.Utilities.eventMixin);\r\n    \r\n    /**\r\n     * @classdesc\r\n     * Wrapper for {@link WinJSContrib.Messenger} when using it with a webworker\r\n     * @class\r\n     * @param {string} [path] path to web worker file\r\n     */\r\n    export var SmartWorker = function(path) {\r\n        if (__global && __global.Worker) {\r\n            var w = new __global.Worker(path || WinJSContrib.Messenger.SmartWorkerPath);\r\n            return new WinJSContrib.Messenger(w, w);\r\n        }\r\n\r\n        return new WinJSContrib.Messenger(null, null);\r\n    }\r\n    var m = <any>Messenger;\r\n    m.SmartWorker = (path) => {\r\n        console.warn(\"WinJSContrib.Messenger.SmartWorker is deprecated, use WinJSContrib.SmartWorker instead\");\r\n        return SmartWorker(path);\r\n    }\r\n}\r\n\r\n"],"sourceRoot":"/source/"}