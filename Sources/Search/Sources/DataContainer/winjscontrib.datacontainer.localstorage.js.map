{"version":3,"sources":["Sources/DataContainer/winjscontrib.datacontainer.localstorage.ts"],"names":["WinJSContrib","WinJSContrib.DataContainer","WinJSContrib.DataContainer.LocalStorageContainer","WinJSContrib.DataContainer.LocalStorageContainer.constructor","WinJSContrib.DataContainer.LocalStorageContainer.makeCurrent","WinJSContrib.DataContainer.LocalStorageContainer.read","WinJSContrib.DataContainer.LocalStorageContainer.save","WinJSContrib.DataContainer.LocalStorageContainer.remove","WinJSContrib.DataContainer.LocalStorageContainer.listKeys","WinJSContrib.DataContainer.LocalStorageContainer.list","WinJSContrib.DataContainer.LocalStorageContainer.child","WinJSContrib.DataContainer.LocalStorageContainer.childWithTransaction","WinJSContrib.DataContainer.LocalStorageContainer.deleteContainer"],"mappings":"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CA,EAAEA,CAACA,GAAGA,IAAIA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACnCA,EAAEA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,OAAOA,CAACA,IAAIA,CAACA,UAAUA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,CAACA;wBACzCA,CAACA,CAACA,IAAIA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,OAAOA,CAACA,IAAIA,CAACA,UAAUA,GAAGA,GAAGA,EAAEA,EAAEA,CAACA,CAACA,CAACA;oBACvDA,CAACA;gBACLA,CAACA;gBAEDA,MAAMA,CAACA,KAAKA,CAACA,OAAOA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA;YACjCA,CAACA;YAEDN,oCAAIA,GAAJA;gBACIO,IAAIA,IAAIA,GAAGA,MAAMA,CAACA,IAAIA,CAACA,YAAYA,CAACA,CAACA;gBACrCA,IAAIA,CAACA,GAAGA,EAAEA,CAACA;gBACXA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,IAAIA,CAACA,MAAMA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;oBACnCA,EAAEA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,OAAOA,CAACA,IAAIA,CAACA,UAAUA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,CAACA;wBACzCA,CAACA,CAACA,IAAIA,CAACA,EAAEA,WAAWA,EAAEA,IAAIA,CAACA,CAACA,CAACA,CAACA,OAAOA,CAACA,IAAIA,CAACA,UAAUA,GAAGA,GAAGA,EAAEA,EAAEA,CAACA,EAAEA,CAACA,CAACA;oBACxEA,CAACA;gBAELA,CAACA;gBAEDA,MAAMA,CAACA,KAAKA,CAACA,OAAOA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA;YACjCA,CAACA;YAEDP,qCAAKA,GAALA,UAAMA,GAAGA;gBACLQ,EAAEA,CAACA,CAACA,IAAIA,CAACA,MAAMA,CAACA,GAAGA,CAACA,CAACA;oBACjBA,MAAMA,CAACA,IAAIA,CAACA,MAAMA,CAACA,GAAGA,CAACA,CAACA;gBAE5BA,IAAIA,GAAGA,GAAGA,IAAIA,qBAAqBA,CAACA,GAAGA,EAAEA,IAAIA,CAACA,OAAOA,EAAEA,IAAIA,CAACA,CAACA;gBAC7DA,IAAIA,CAACA,MAAMA,CAACA,GAAGA,CAACA,GAAGA,GAAGA,CAACA;gBACvBA,MAAMA,CAACA,GAAGA,CAACA;YACfA,CAACA;YAEDR,oDAAoBA,GAApBA,UAAqBA,GAAWA,EAAEA,OAA2DA;gBACzFS,IAAIA,OAAOA,GAAGA,IAAIA,CAACA;gBACnBA,IAAIA,GAAGA,GAAQA,KAAKA,CAACA,OAAOA,CAACA,SAASA,CAACA,EAAEA,OAAOA,EAAEA,wCAAwCA,EAAEA,CAACA,CAACA;gBAC9FA,MAAMA,CAAuCA,GAAGA,CAACA;YACrDA,CAACA;YAEDT,+CAAeA,GAAfA;gBACIU,YAAYA,CAACA,UAAUA,CAACA,IAAIA,CAACA,UAAUA,CAACA,CAACA;gBACzCA,EAAEA,CAACA,CAACA,IAAIA,CAACA,MAAMA,IAAIA,IAAIA,CAACA,MAAMA,CAACA,MAAMA,CAACA,IAAIA,CAACA,GAAGA,CAACA,CAACA,CAACA,CAACA;oBAC9CA,IAAIA,CAACA,MAAMA,CAACA,MAAMA,CAACA,IAAIA,CAACA,GAAGA,CAACA,GAAGA,IAAIA,CAACA;gBACxCA,CAACA;gBACDA,MAAMA,CAACA,KAAKA,CAACA,OAAOA,CAACA,IAAIA,EAAEA,CAACA;YAChCA,CAACA;YACLV,4BAACA;QAADA,CA5GAD,AA4GCC,IAAAD;QA5GYA,mCAAqBA,wBA4GjCA,CAAAA;IACLA,CAACA,EAhHmBD,aAAaA,GAAbA,0BAAaA,KAAbA,0BAAaA,QAgHhCA;AAADA,CAACA,EAhHM,YAAY,KAAZ,YAAY,QAgHlB","file":"Sources/DataContainer/winjscontrib.datacontainer.localstorage.js","sourcesContent":["var __global = this;\r\n\r\nmodule WinJSContrib.DataContainer {\r\n    export var current = WinJSContrib.DataContainer.current || null;\r\n\r\n    export class LocalStorageContainer implements IDataContainer {\r\n        public key: string;\r\n        public parent: LocalStorageContainer;\r\n        public useDataCache: boolean;\r\n        storageKey: string;\r\n        options: any;\r\n        childs: any;\r\n\r\n        static makeCurrent(key?: string, options?: any) {\r\n            WinJSContrib.DataContainer.current = new LocalStorageContainer(key, options);\r\n        }\r\n\r\n        constructor(key?: string, options?: any, parent?: LocalStorageContainer) {\r\n            this.key = key || 'mcndatacontainer';\r\n            this.options = options;\r\n            this.parent = parent;\r\n            if (parent) {\r\n                this.storageKey = parent.storageKey + '#' + this.key;\r\n            } else {\r\n                this.storageKey = this.key;\r\n            }\r\n        }\r\n\r\n        read(itemkey) {\r\n            var container = this;\r\n            var storagekey = container.storageKey + '###' + itemkey;\r\n            var tmp = localStorage[storagekey];\r\n            if (tmp) {\r\n                tmp = JSON.parse(tmp);\r\n                //if (container.options.logger)\r\n                //    container.options.logger.debug('readed ' + storagekey);\r\n            }\r\n            else {\r\n                //if (container.options.logger)\r\n                //    container.options.logger.debug('reading empty ' + storagekey);\r\n            }\r\n            return WinJS.Promise.wrap(tmp);\r\n        }\r\n\r\n        save(itemkey, obj) {\r\n            var container = this;\r\n            if (obj) {\r\n                var tmp = JSON.stringify(obj);\r\n                var storagekey = container.storageKey + '###' + itemkey;\r\n                if (container.options.logger)\r\n                    container.options.logger.debug('saving ' + storagekey);\r\n                localStorage[storagekey] = tmp;\r\n            }\r\n            return WinJS.Promise.wrap();\r\n        }\r\n\r\n        remove(itemkey) {\r\n            var container = this;\r\n            var storagekey = container.storageKey + '###' + itemkey;\r\n            localStorage.removeItem(storagekey);\r\n            if (container.options.logger)\r\n                container.options.logger.debug('removing ' + storagekey);\r\n\r\n            return WinJS.Promise.wrap();\r\n        }\r\n\r\n        listKeys() {\r\n            var keys = Object.keys(localStorage);\r\n            var l = [];\r\n            for (var i = 0; i < keys.length; i++) {\r\n                if (keys[i].indexOf(this.storageKey) != -1) {\r\n                    l.push(keys[i].replace(this.storageKey + \"#\", ''));\r\n                }\r\n            }\r\n\r\n            return WinJS.Promise.wrap(l);\r\n        }\r\n\r\n        list() {\r\n            var keys = Object.keys(localStorage);\r\n            var l = [];\r\n            for (var i = 0; i < keys.length; i++) {\r\n                if (keys[i].indexOf(this.storageKey) != -1) {\r\n                    l.push({ displayName: keys[i].replace(this.storageKey + \"#\", '') });\r\n                }\r\n\r\n            }\r\n\r\n            return WinJS.Promise.wrap(l);\r\n        }\r\n\r\n        child(key): LocalStorageContainer {\r\n            if (this.childs[key])\r\n                return this.childs[key];\r\n\r\n            var res = new LocalStorageContainer(key, this.options, this);\r\n            this.childs[key] = res;\r\n            return res;\r\n        }\r\n\r\n        childWithTransaction(key: string, process: (arg: LocalStorageContainer) => WinJS.Promise<any>): WinJS.Promise<LocalStorageContainer> {\r\n            var current = this;\r\n            var err = <any>WinJS.Promise.wrapError({ message: \"Not yet implemented for this container\" });\r\n            return <WinJS.Promise<LocalStorageContainer>>err;\r\n        }\r\n\r\n        deleteContainer(): WinJS.Promise<any> {            \r\n            localStorage.removeItem(this.storageKey);\r\n            if (this.parent && this.parent.childs[this.key]) {\r\n                this.parent.childs[this.key] = null;\r\n            }\r\n            return WinJS.Promise.wrap();\r\n        }\r\n    }\r\n}"],"sourceRoot":"/source/"}