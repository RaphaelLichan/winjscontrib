{"version":3,"sources":["Sources/DataContainer/winjscontrib.datacontainer.winrt.file.ts"],"names":["WinJSContrib","WinJSContrib.DataContainer","WinJSContrib.DataContainer.WinRTFilesContainer","WinJSContrib.DataContainer.WinRTFilesContainer.constructor","WinJSContrib.DataContainer.WinRTFilesContainer.makeCurrent","WinJSContrib.DataContainer.WinRTFilesContainer.read","WinJSContrib.DataContainer.WinRTFilesContainer.save","WinJSContrib.DataContainer.WinRTFilesContainer.remove","WinJSContrib.DataContainer.WinRTFilesContainer.listKeys","WinJSContrib.DataContainer.WinRTFilesContainer.list","WinJSContrib.DataContainer.WinRTFilesContainer.child","WinJSContrib.DataContainer.WinRTFilesContainer.childWithTransaction","WinJSContrib.DataContainer.WinRTFilesContainer.deleteContainer","WinJSContrib.DataContainer.WinRTFilesContainer.clearAllCache","WinJSContrib.DataContainer.WinRTFilesContainer.clearCache","WinJSContrib.DataContainer.WinRTFilesContainer.clearDataCache","WinJSContrib.DataContainer.toJSONFileName","WinJSContrib.DataContainer.deleteItemIfExistsAsync","WinJSContrib.DataContainer.getFileContentAsJSONAsync","WinJSContrib.DataContainer.readFileAsync","WinJSContrib.DataContainer.writeFileAsync","manageError"],"mappings":"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","file":"Sources/DataContainer/winjscontrib.datacontainer.winrt.file.js","sourcesContent":["var __global = this;\r\n\r\nmodule WinJSContrib.DataContainer {\r\n    export var current = WinJSContrib.DataContainer.current || null;\r\n    var containerLogger = WinJSContrib.Logs.getLogger(\"WinJSContrib.DataContainer.WinRT\");\r\n        \r\n    export class WinRTFilesContainer implements IDataContainer {\r\n        public key: string;\r\n        public parent: WinRTFilesContainer;\r\n        public useDataCache: boolean;\r\n        dataCache: any;\r\n        childs: any;\r\n        folder: Windows.Storage.StorageFolder;\r\n        options: any;\r\n        folderPromise: WinJS.Promise<Windows.Storage.StorageFolder>;\r\n\r\n        static makeCurrent(key?: string, options?: any) {\r\n            WinJSContrib.DataContainer.current = new WinRTFilesContainer(key, options);\r\n        }\r\n\r\n        constructor(key?: string, options?:any, parent?: WinRTFilesContainer) {\r\n            var container = this;\r\n            container.key = key;\r\n            container.options = options || {};\r\n            container.parent = parent;\r\n            container.folderPromise;\r\n            container.useDataCache = container.options.useDataCache || false;\r\n            container.dataCache = {};\r\n\r\n            container.childs = {};\r\n\r\n            if (!__global.Windows)\r\n                throw \"WinRT is required !\";\r\n\r\n            if (!key) {\r\n                container.folder = Windows.Storage.ApplicationData.current.localFolder;\r\n                container.folderPromise = WinJS.Promise.wrap(container.folder);\r\n            }\r\n            else if (parent) {\r\n                container.folderPromise = parent.folderPromise.then(function (parentfolder) {\r\n                    if (container.options.logger) container.options.logger.debug(\"open folder \" + key);\r\n                    return parentfolder.createFolderAsync(key, Windows.Storage.CreationCollisionOption.openIfExists)\r\n                }).then(function (folder) {\r\n                    container.folder = folder;\r\n                    return folder;\r\n                });\r\n            }\r\n        }\r\n\r\n        public read<T>(itemkey: string): WinJS.Promise<T> {\r\n            var container = this;\r\n            if (container.useDataCache) {\r\n                var data = container.dataCache[itemkey];\r\n                if (data) {\r\n                    //clone object to avoid unintended object alteration\r\n                    var clone = JSON.parse(JSON.stringify(data));\r\n                    return WinJS.Promise.wrap(clone);\r\n                }\r\n            }\r\n\r\n            return container.folderPromise.then(function (folder) {\r\n                return readFileAsync(folder, itemkey, container.options.encrypted, Windows.Storage.CreationCollisionOption.openIfExists, 0, container.options.logger).then(function (data) {\r\n                    \r\n                    if (container.useDataCache) {\r\n                        container.dataCache[itemkey] = data;\r\n                    }\r\n                    return data;\r\n                });\r\n            });\r\n        }\r\n\r\n        public save(itemkey, obj): WinJS.Promise<any> {\r\n            var container = this;\r\n            if (container.useDataCache) {\r\n                container.dataCache[itemkey] = obj;\r\n            }\r\n\r\n            return container.folderPromise.then(function (folder) {\r\n                return writeFileAsync(folder, itemkey, obj, container.options.encrypted, Windows.Storage.CreationCollisionOption.replaceExisting, 0, container.options.logger);\r\n            });\r\n        }\r\n\r\n        public remove(itemkey): WinJS.Promise<any> {\r\n            var container = this;\r\n\r\n            return container.folderPromise.then(function (folder) {\r\n                return deleteItemIfExistsAsync(folder, itemkey, container.options.logger);\r\n            });\r\n\r\n        }\r\n\r\n        public listKeys(): WinJS.Promise<string[]> {\r\n            var container = this;\r\n\r\n            return container.folderPromise.then(function (folder) {\r\n                return folder.getFilesAsync().then(function (files) {\r\n                    return files.map(function (f) {\r\n                        var key = f.path.substr(folder.path.length + 1);\r\n                        var ext = key.indexOf('.json');\r\n                        if (ext > 0) {\r\n                            key = key.substr(0, ext);\r\n                        }\r\n                        return key;\r\n                    });\r\n                });\r\n            });\r\n        }\r\n\r\n        public list() {\r\n            var container = this;\r\n\r\n            return container.folderPromise.then(function (folder) {\r\n                return folder.getFilesAsync();\r\n            });\r\n        }\r\n\r\n        public child(key): WinRTFilesContainer {\r\n            if (this.childs[key])\r\n                return this.childs[key];\r\n\r\n            var res = new WinRTFilesContainer(key, this.options, this);\r\n            this.childs[key] = res;\r\n            return res;\r\n        }\r\n\r\n        public childWithTransaction(key: string, process: (arg: WinRTFilesContainer) => WinJS.Promise<any>): WinJS.Promise<WinRTFilesContainer> {\r\n            var current = this;\r\n\r\n            return this.child(key + \"-tmp\").folderPromise.then(function (winrtfolder) {\r\n                return winrtfolder.deleteAsync().then(function () {\r\n                    return current.child(key + \"-tmp\");\r\n                });\r\n            }).then(function (folder) {\r\n                return process(folder).then(function (data) {\r\n                    return folder.folderPromise.then(function (winrtfolder) {\r\n                        return winrtfolder.renameAsync(key, Windows.Storage.NameCollisionOption.replaceExisting).then(function () {\r\n                            current.childs[key] = null;\r\n                            current.childs[key + \"-tmp\"] = null;\r\n                            return current.child(key);\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        }\r\n\r\n        public deleteContainer(): WinJS.Promise<any> {\r\n            var container = this;\r\n            return container.folderPromise.then(function (folder) {\r\n                return folder.deleteAsync();\r\n            });\r\n        }\r\n\r\n        public clearAllCache() {\r\n            var container = this;\r\n            container.clearCache();\r\n            container.clearDataCache();\r\n        }\r\n\r\n        public clearCache() {\r\n            var container = this;\r\n            container.childs = {};\r\n\r\n            for (var k in container.childs) {\r\n                if (container.childs.hasOwnProperty(k)) {\r\n                    container.childs[k].clearCache();\r\n                }\r\n            }\r\n        }\r\n\r\n        public clearDataCache() {\r\n            var container = this;\r\n\r\n            container.dataCache = {};\r\n\r\n            for (var k in container.childs) {\r\n                if (container.childs.hasOwnProperty(k)) {\r\n                    container.childs[k].clearDataCache();\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    function toJSONFileName(fileName) {\r\n        return encodeURIComponent(fileName) + \".json\";\r\n    }\r\n\r\n    function deleteItemIfExistsAsync(folder, itemName, logger) {\r\n        return folder.getItemAsync(toJSONFileName(itemName)).then(function (item) {\r\n            return item;\r\n        }, function () {\r\n        }).then(function (item) {\r\n            if (item) {\r\n                return item.deleteAsync().then(function () {\r\n                    if (logger) logger.debug(\"item deleted \" + item.path);\r\n                }, function (err) {\r\n                    if (logger) logger.error(\"cannot delete item \" + item.path);\r\n                });\r\n            } else {\r\n                return WinJS.Promise.wrap([]);\r\n            }\r\n        });\r\n    }\r\n\r\n    function getFileContentAsJSONAsync(file, encrypted) {\r\n        return Windows.Storage.FileIO.readBufferAsync(file).then(function (cypheredText) {\r\n            if (!encrypted)\r\n                return cypheredText;\r\n\r\n            // On vérifie que le fichier n'est pas vide\r\n            if (cypheredText.length) {\r\n                var provider = new Windows.Security.Cryptography.DataProtection.DataProtectionProvider();\r\n                return provider.unprotectAsync(cypheredText);\r\n            } else {\r\n                return null;\r\n            }\r\n        }).then(function (unprotectedData: Windows.Storage.Streams.IBuffer) {\r\n            var obj = null;\r\n            if (unprotectedData !== null && unprotectedData !== undefined) {\r\n                var rawText = Windows.Security.Cryptography.CryptographicBuffer.convertBinaryToString(Windows.Security.Cryptography.BinaryStringEncoding.utf8, unprotectedData);\r\n                if (rawText) {\r\n                    try {\r\n                        obj = JSON.parse(rawText);\r\n                    } catch (exception) { }\r\n                }\r\n            }\r\n\r\n            return obj;\r\n        });\r\n    }\r\n\r\n    function readFileAsync(folder, fileName, encrypted, creationCollisionOption, retry, logger) {\r\n        logger = logger || containerLogger;\r\n        return new WinJS.Promise(function (readComplete, readError) {\r\n            retry = retry || 0;\r\n            creationCollisionOption = creationCollisionOption || Windows.Storage.CreationCollisionOption.openIfExists;\r\n            var filename = toJSONFileName(fileName);\r\n            //folder.getFilesAsync(filename).then(function(file){})\r\n\r\n            folder.getFileAsync(filename).then(function (file) {\r\n                return getFileContentAsJSONAsync(file, encrypted);\r\n            }).then(function (res) {\r\n                logger.verbose(\"read \" + folder.path + '\\\\' + toJSONFileName(fileName));\r\n                readComplete(res);\r\n            }, function (err) {\r\n                if (err.number == -2147024894) {\r\n                    logger.debug(\"read empty \" + folder.path + '\\\\' + toJSONFileName(fileName));\r\n                    readComplete();\r\n                    return;\r\n                }\r\n\r\n                logger.warn(\"error reading \" + folder.path + '\\\\' + toJSONFileName(fileName));\r\n                if (retry < 2) {\r\n                    setImmediate(function () {\r\n                        logger.info(\"retry reading \" + folder.path + '\\\\' + toJSONFileName(fileName));\r\n                        readFileAsync(folder, fileName, encrypted, creationCollisionOption, retry + 1, logger).then(readComplete, readError);\r\n                    });\r\n                } else {\r\n                    readError({ message: 'fatal error reading ' + folder.path + '\\\\' + toJSONFileName(fileName), exception: err });\r\n                }\r\n            });\r\n        });\r\n    }\r\n\r\n    function writeFileAsync(folder, fileName, objectGraph, encrypt, creationCollisionOption, retry, logger) {\r\n        logger = logger || containerLogger;\r\n        return new WinJS.Promise(function (writeComplete, writeError) {\r\n            retry = retry || 0;\r\n            creationCollisionOption = creationCollisionOption || Windows.Storage.CreationCollisionOption.replaceExisting;\r\n            var bufferedText = Windows.Security.Cryptography.CryptographicBuffer.convertStringToBinary(JSON.stringify(objectGraph), Windows.Security.Cryptography.BinaryStringEncoding.utf8);\r\n            if (encrypt) {\r\n                var provider = new Windows.Security.Cryptography.DataProtection.DataProtectionProvider(\"Local=user\");\r\n            }\r\n\r\n            function manageError(err) {\r\n                logger.warn(\"error writing \" + folder.path + '\\\\' + toJSONFileName(fileName));\r\n                if (retry < 2) {\r\n                    setImmediate(function () {\r\n                        logger.info(\"retry writing \" + folder.path + '\\\\' + toJSONFileName(fileName));\r\n                        writeFileAsync(folder, fileName, objectGraph, encrypt, creationCollisionOption, retry + 1, logger).then(writeComplete, writeError);\r\n                    });\r\n                }\r\n                else {\r\n                    writeError({ message: \"fatal error writing \" + folder.path + '\\\\' + toJSONFileName(fileName) + '\\r\\n', exception: err });\r\n                }\r\n            }\r\n\r\n            // Ces deux opérations ne sont pas dépendantes l'une de l'autre et peuvent s'exécuter en parallèle\r\n            var filePromise = folder.createFileAsync(toJSONFileName(fileName), creationCollisionOption);\r\n            var protectionPromise = encrypt ? provider.protectAsync(bufferedText) : WinJS.Promise.wrap(bufferedText);\r\n\r\n            WinJS.Promise.join([filePromise, protectionPromise]).then(function (data) {\r\n                var file = data[0];\r\n                var protectedData = data[1];\r\n\r\n                Windows.Storage.FileIO.writeBufferAsync(file, protectedData).then(function () {\r\n                    logger.verbose(\"file written \" + file.path);\r\n                    //setImmediate(function () {\r\n                    writeComplete(file);\r\n                    //});\r\n                }, manageError);\r\n            }, manageError);\r\n        });\r\n    }\r\n}"],"sourceRoot":"/source/"}